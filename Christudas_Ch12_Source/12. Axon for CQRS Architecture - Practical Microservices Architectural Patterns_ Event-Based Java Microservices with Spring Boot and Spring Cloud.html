<!DOCTYPE html>
<!-- saved from url=(0127)https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml -->
<html class=" js flexbox flexboxlegacy no-touch websqldatabase indexeddb history csscolumns csstransforms localstorage sessionstorage applicationcache svg inlinesvg zoom" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#" itemscope="" itemtype="http://schema.org/Book http://schema.org/ItemPage" data-login-url="/accounts/login/" data-offline-url="/" data-url="/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml" data-csrf-cookie="csrfsafari" data-highlight-privacy="private" data-user-id="4423847" data-user-uuid="6d9ee17b-34b1-4bf4-bdae-19676bd84ca1" data-username="fwang3" data-account-type="B2B" data-activated-trial-date="" data-archive="9781484245019" data-publishers="Apress" data-htmlfile-name="477630_1_En_12_Chapter.xhtml" data-epub-title="Practical Microservices Architectural Patterns: Event-Based Java Microservices with Spring Boot and Spring Cloud" data-debug="0" data-testing="0" style=""><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="author" content="O&#39;Reilly Media"><meta name="format-detection" content="telephone=no"><meta http-equiv="cleartype" content="on"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="apple-itunes-app" content="app-id=881697395, app-argument=safaridetail://9781484245019"><link rel="shortcut icon" href="https://www.oreilly.com/favicon.ico"><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0"><meta property="twitter:account_id" content="4503599627559754"><link rel="shortcut icon" href="https://learning.oreilly.com/favicon.ico" type="image/x-icon"><link href="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/css" rel="stylesheet" type="text/css"><title>12.&nbsp;Axon for CQRS Architecture - Practical Microservices Architectural Patterns: Event-Based Java Microservices with Spring Boot and Spring Cloud</title><link rel="stylesheet" href="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/output.731fc84.css" type="text/css"><link rel="stylesheet" type="text/css" href="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/annotator.e3b0.css"><link rel="stylesheet" href="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/font-awesome.m.css"><style type="text/css" title="ibis-book">
    #sbo-rt-content a{text-decoration:none}#sbo-rt-content a:link,#sbo-rt-content a:active{color:#0176C3}#sbo-rt-content a:visited{color:#5f5f5f}#sbo-rt-content div{font-family:"Cambria","Minion Pro","Times New Roman","Times",serif;}#sbo-rt-content img{border:0;vertical-align:middle}#sbo-rt-content video{display:block;margin-top:1em;max-width:100%;text-indent:0;width:100%}#sbo-rt-content p{margin:0}#sbo-rt-content .Heading,#sbo-rt-content .SubHeading,#sbo-rt-content .ContextInformation,#sbo-rt-content .MainTitleSection,#sbo-rt-content .PartTitle,#sbo-rt-content .SeriesTitle,#sbo-rt-content .SeriesSubTitle,#sbo-rt-content .SubSeriesTitle,#sbo-rt-content .SubSeriesSubTitle,#sbo-rt-content .BookTitle,#sbo-rt-content .BookSubTitle,#sbo-rt-content .ForewordTitle,#sbo-rt-content .PrefaceTitle,#sbo-rt-content .BookAcknowledgmentsTitle,#sbo-rt-content .BookNotesTitle{text-align:left !important}#sbo-rt-content .Heading,#sbo-rt-content .SubHeading{display:block;font-weight:bold}#sbo-rt-content .ArticleContextInformation{border-bottom:1px solid;margin-bottom:.8em;padding-bottom:.3em}#sbo-rt-content .ArticleContextInformation .ContextInformation{display:block;font-size:80%}#sbo-rt-content .ArticleContextInformation .JournalTitle:after,#sbo-rt-content .ArticleContextInformation .JournalSubTitle:after{content:", "}#sbo-rt-content .ArticleCopyright{display:inline}#sbo-rt-content .ArticleCopyright .CopyrightComment,#sbo-rt-content .ArticleContextInformation .ArticleDOI{display:block}#sbo-rt-content .ChapterContextInformation{border-bottom:1px solid;margin-bottom:.8em;padding-bottom:.3em}#sbo-rt-content .ChapterContextInformation .ContextInformation{display:block;font-size:80%}#sbo-rt-content .ChapterCopyright .CopyrightComment{display:block}#sbo-rt-content .ChapterContextInformation .BookEdition:before{content:", "}#sbo-rt-content .ChapterContextInformation .ContextInformationAuthorEditorNames:after{content:", "}#sbo-rt-content .ChapterContextInformation .BookTitle{font-style:italic}#sbo-rt-content .ChapterContextInformation .SeriesTitle:before{content:", "}#sbo-rt-content .ChapterContextInformation .SeriesSubTitle:before{content:": "}#sbo-rt-content .ChapterContextInformation .ContextInformationVolumeNumber:before{content:" "}#sbo-rt-content .ChapterContextInformation .ChapterDOI{display:block}#sbo-rt-content .Categories{color:#666;margin-bottom:1em;margin-top:1em}#sbo-rt-content .ArticleCategory,#sbo-rt-content .ChapterCategory{font-size:1.2rem}#sbo-rt-content .ArticleSubCategory,#sbo-rt-content .ChapterSubCategory{font-size:1rem}#sbo-rt-content .MainTitleSection{font-weight:bold;margin-bottom:1.2em;margin-top:1.2em}#sbo-rt-content .ArticleSuperTitle{font-size:1.2rem}#sbo-rt-content .MainTitleSection .ArticleTitle,#sbo-rt-content .ForeignLanguageHeader .ArticleTitle,#sbo-rt-content .MainTitleSection .ChapterTitle,#sbo-rt-content .ForeignLanguageHeader .ChapterTitle{font-size:1.73rem;margin:0}#sbo-rt-content .ArticleSubTitle,#sbo-rt-content .ChapterSubTitle{font-size:1.2rem;padding-top:.2em}#sbo-rt-content div>.AuthorGroup .AuthorNames,#sbo-rt-content .BookBackmatter>.AuthorGroup .AuthorNames{font-size:100%;margin-bottom:1em;margin-top:1em;text-align:left !important}#sbo-rt-content .BookBackmatter>.AuthorGroup .AuthorNames{font-weight:bold}#sbo-rt-content .AuthorNames sup{font-size:70%}#sbo-rt-content .Prefix:after{content:" "}#sbo-rt-content .Suffix:before{content:" "}#sbo-rt-content .Degrees:before{content:", "}#sbo-rt-content .NativeName:before,#sbo-rt-content .Role:before{content:" ("}#sbo-rt-content .NativeName:after,#sbo-rt-content .Role:after{content:")"}#sbo-rt-content .AffiliationNumber{float:left;padding-right:.5em}#sbo-rt-content .AffiliationText{margin-left:2em}#sbo-rt-content .AffiliationHint{font-style:italic}#sbo-rt-content .AuthorNames .DeceasedSymbol:before{content:"†";padding-left:3px}#sbo-rt-content .AuthorNames .EqualContributionSymbol:before{content:"*";padding-left:3px}#sbo-rt-content .InstitutionMembers:before{content:" ("}#sbo-rt-content .InstitutionMembers:after{content:")"}#sbo-rt-content .AffiliationLegend .DeceasedSymbol:before{content:"†";display:inline-block;width:14px}#sbo-rt-content .AffiliationLegend .EqualContributionSymbol:before{content:"*";display:inline-block;width:14px}#sbo-rt-content .ClearBoth{clear:both;font-size:0;line-height:0 !important}#sbo-rt-content .Contact,#sbo-rt-content .AffiliationLegend{margin-bottom:1em;margin-top:1em}#sbo-rt-content .ContactIcon{background-image:url(envelope.png);background-repeat:no-repeat;background-size:contain;width:.8rem}#sbo-rt-content .AuthorNames .ContactIcon{display:inline-block}#sbo-rt-content .Contact .ContactIcon{float:left;margin-top:4px;margin-right:4px}#sbo-rt-content .ContactAuthorLine{padding-left:20px;font-weight:bold}#sbo-rt-content .ContactAdditionalLine{padding-left:20px}#sbo-rt-content .ContactType{font-weight:bold}#sbo-rt-content .ArticleHistory{margin-bottom:1em;margin-top:1em}#sbo-rt-content .HistoryLabel{font-weight:bold}#sbo-rt-content .History+.History{padding-left:.5em}#sbo-rt-content .ArticleOrChapterToc{border-top:1px solid #bbb;margin-top:1em;padding-top:1em}#sbo-rt-content .ArticleOrChapterToc .HeadingNumber{font-weight:bold;padding-right:.3em}#sbo-rt-content .Abstract{margin-top:1em}#sbo-rt-content .Abstract>.Heading{font-size:1em;margin:0}#sbo-rt-content .AbstractSection{margin-top:.3em}#sbo-rt-content .Heading+.AbstractSection{margin-top:0}#sbo-rt-content .AbstractSection>.Heading{font-size:1em;font-style:italic;font-weight:normal;margin:0}#sbo-rt-content .KeywordGroup{margin-top:1em}#sbo-rt-content .KeywordGroup .Heading{display:inline;font-size:1em;margin:0;padding-right:.5em}#sbo-rt-content .Keyword+.Keyword:before{content:" – "}#sbo-rt-content .ArticleExternalID{margin-top:1em}#sbo-rt-content .ArticleExternalIDLabel{font-weight:bold}#sbo-rt-content .ForeignLanguageHeader{border-top:1px solid #bbb;margin-top:1em}#sbo-rt-content .ForeignLanguageTitleSection{font-weight:bold;margin-bottom:1.2em;margin-top:1rem}#sbo-rt-content .AbbreviationGroup{margin-top:1em}#sbo-rt-content .ForeignLanguageHeader+.AbbreviationGroup{border-top:1px solid #bbb;margin-top:1em;padding-top:1em}#sbo-rt-content .AbbreviationGroup>.Heading{font-size:1em;margin:0}#sbo-rt-content .AbbreviationGroup .DefinitionList{margin-top:0;margin-bottom:0;padding-right:.1em;padding-top:.1em;padding-bottom:.1em}#sbo-rt-content .AbbreviationGroupSection>.Heading{font-size:1em;margin:0;padding-top:.2em}#sbo-rt-content .ArticleNote{margin-top:1em}#sbo-rt-content .ArticleNote>.Heading{font-size:1em;margin:0}#sbo-rt-content .ArticleNoteMotto{font-style:italic;margin-left:1.5em;margin-right:1.5em;text-align:right}#sbo-rt-content .Biography{display:block;margin-top:.8em;padding-bottom:0;width:100%}#sbo-rt-content .Loc .AuthorGroup .Biography{margin-top:0}#sbo-rt-content .Biography .FormalPara,#sbo-rt-content .Biography .BiographyFigure{display:block;margin-top:0;margin-bottom:0}#sbo-rt-content .Biography .BiographyFigure{float:right;margin-left:6px}#sbo-rt-content .Biography .Figure{border-bottom:none;margin-top:.5em;margin-bottom:0}#sbo-rt-content .Fulltext>.Para:first-of-type>.BlockQuote:first-child{margin-top:0}#sbo-rt-content .BlockQuote{margin:1em 1.5em}#sbo-rt-content .BlockQuote>.Heading{font-size:1em;margin-top:1em;margin-bottom:0;text-indent:0}#sbo-rt-content .BlockQuote>.Para{text-indent:0}#sbo-rt-content .Heading+.Para>.BlockQuote:first-child{margin-top:0}#sbo-rt-content .Caption,#sbo-rt-content .TableFooter{display:block;text-align:left}#sbo-rt-content .TableFooter .SimplePara+.SimplePara{text-indent:0}#sbo-rt-content .Caption{margin-top:.5em}#sbo-rt-content .CaptionContent{font-size:90%}#sbo-rt-content .TableFooter{margin-top:1em}#sbo-rt-content .Table .Caption{margin-top:.5em}#sbo-rt-content .Figure .Caption,#sbo-rt-content video+.Caption{margin-bottom:1em}#sbo-rt-content .Table .Caption{margin-bottom:.5em}#sbo-rt-content .CaptionNumber{font-style:italic;font-weight:bold;padding-right:.6em}#sbo-rt-content .CaptionContent>span.Heading{display:inline}#sbo-rt-content .CaptionContent>span.SimplePara{display:block}#sbo-rt-content .CaptionContent>.SimplePara:first-child,#sbo-rt-content .CaptionContent>.CaptionNumber+.SimplePara,#sbo-rt-content .CaptionContent>a+.SimplePara{display:inline;margin-top:0}#sbo-rt-content .Credit>.SimplePara{text-indent:1.5em}#sbo-rt-content .DefinitionList{margin-top:1em;margin-bottom:1em;padding:.1em}#sbo-rt-content .DefinitionList>.Heading{font-size:1rem;margin:0;text-indent:0}#sbo-rt-content dl{margin:0}#sbo-rt-content .DefinitionList:after{content:"";clear:both;display:table}#sbo-rt-content .Term{clear:both;float:left;font-style:italic;padding-right:1em;text-indent:0;vertical-align:top}#sbo-rt-content .Description{padding-bottom:.3em;margin-left:0}#sbo-rt-content .Description .Para:first-child{text-indent:0}#sbo-rt-content .Heading+.Para>div.DefinitionList:first-child{margin-top:0}#sbo-rt-content .EmphasisTypeBold{font-weight:bold}#sbo-rt-content .EmphasisTypeItalic{font-style:italic}#sbo-rt-content .EmphasisTypeUnderline{text-decoration:underline}#sbo-rt-content .EmphasisTypeDoubleUnderline{border-bottom-style:double}#sbo-rt-content .EmphasisTypeSmallCaps{font-variant:small-caps}#sbo-rt-content .EmphasisTypeBoldItalic{font-weight:bold;font-style:italic}#sbo-rt-content .EmphasisTypeBoldUnderline{font-weight:bold;text-decoration:underline}#sbo-rt-content .EmphasisTypeBoldDoubleUnderline{font-weight:bold;border-bottom-style:double}#sbo-rt-content .EmphasisTypeBoldSmallCaps{font-weight:bold;font-variant:small-caps}#sbo-rt-content .EmphasisTypeItalicUnderline{font-style:italic;text-decoration:underline}#sbo-rt-content .EmphasisTypeItalicDoubleUnderline{font-style:italic;border-bottom-style:double}#sbo-rt-content .EmphasisTypeItalicSmallCaps{font-style:italic;font-variant:small-caps}#sbo-rt-content .EmphasisTypeBoldItalicUnderline{font-weight:bold;font-style:italic;text-decoration:underline}#sbo-rt-content .EmphasisTypeBoldItalicDoubleUnderline{font-weight:bold;font-style:italic;border-bottom-style:double}#sbo-rt-content .EmphasisTypeBoldItalicSmallCaps{font-weight:bold;font-style:italic;font-variant:small-caps}#sbo-rt-content .EmphasisTypeUnderlineSmallCaps{text-decoration:underline;font-variant:small-caps}#sbo-rt-content .EmphasisTypeDoubleUnderlineSmallCaps{border-bottom-style:double;font-variant:small-caps}#sbo-rt-content .EmphasisFontCategoryNonProportional{font-family:"Courier New",Courier,monospace}#sbo-rt-content :not(.ParaTypeProgramcode)>.EmphasisFontCategoryNonProportional{font-size:95%}#sbo-rt-content .EmphasisFontCategorySansSerif{font-family:"Arial","Helvetica",sans-serif;font-size:75%}#sbo-rt-content .EmphasisTypeStrikethrough{text-decoration:line-through}#sbo-rt-content .Equation{display:block;text-indent:0;vertical-align:middle}#sbo-rt-content .NumberedEquation{display:table;width:100%}#sbo-rt-content .NumberedEquation .EquationWrapper{display:table-row}#sbo-rt-content .NumberedEquation .EquationContent{display:table-cell}#sbo-rt-content .EquationContent{margin-top:.5em;margin-bottom:0;width:100%;text-align:center;text-indent:0;vertical-align:middle}#sbo-rt-content .EquationContent div{margin-top:.5em}#sbo-rt-content .EquationContent .MediaObject{margin-left:auto;margin-right:auto}#sbo-rt-content .EquationContent img{background:white;max-width:100%}#sbo-rt-content .EquationNumber{display:table-cell;margin-bottom:.4em;text-align:right;vertical-align:middle;white-space:nowrap}#sbo-rt-content .EquationSourceXml{white-space:nowrap}#sbo-rt-content .InlineEquation img{background:white;vertical-align:text-top}#sbo-rt-content .Figure{margin-top:1em;margin-bottom:1em;margin-left:0;margin-right:0;text-align:center;text-indent:0}#sbo-rt-content .Figure img{height:auto;margin:0;max-width:100%;padding:2px}#sbo-rt-content .MediaObject{display:block;text-align:center}#sbo-rt-content .MediaObject:last-child{margin-bottom:1em}#sbo-rt-content .EquationContent>.MediaObject:last-child{margin-bottom:0}#sbo-rt-content .MediaObject+.MediaObject{margin-top:1em}#sbo-rt-content .FootnoteSection{border-top:1px solid #bbb;margin-top:1em}#sbo-rt-content .FootnoteSection>.Heading{font-size:1.44rem;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Footnote{clear:both;font-size:90%;text-align:left}#sbo-rt-content .FootnoteNumber{float:left;padding-right:.5em}#sbo-rt-content .FootnoteParas>div{margin-left:1em;margin-top:.3em}#sbo-rt-content .FormalPara{margin-top:1em;margin-bottom:1em}#sbo-rt-content .FormalPara .Heading{font-size:1em;margin:0}#sbo-rt-content .FormalParaRenderingStyle1>.Heading{display:inline;padding-right:1em}#sbo-rt-content .FormalParaRenderingStyle2>.Heading{display:inline;font-style:italic;font-weight:normal;padding-right:1em}#sbo-rt-content .FormalParaRenderingStyle3>.Heading{padding-right:1em}#sbo-rt-content .FormalParaRenderingStyle1>p:first-of-type,#sbo-rt-content .FormalParaRenderingStyle2>p:first-of-type{display:inline}#sbo-rt-content .Heading+.FormalPara{margin-top:0}#sbo-rt-content .FormalPara .AuthorNames{font-style:italic;font-weight:normal !important}#sbo-rt-content .HeadingNumber{padding-right:.3em}#sbo-rt-content .RenderAsSection1>.Heading{font-size:1.44rem;margin-top:.5em;margin-bottom:.1em}#sbo-rt-content .RenderAsSection2>.Heading{font-size:1.2rem;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Heading+.Section2>.Heading:first-child{margin-top:0}#sbo-rt-content .RenderAsSection3>.Heading{font-size:1.2rem;font-style:italic;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Heading+.Section3>.Heading:first-child{margin-top:0}#sbo-rt-content .RenderAsSection4>.Heading{font-size:100%;font-style:italic;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Heading+.Section4>.Heading:first-child{margin-top:0}#sbo-rt-content .RenderAsSection5>.Heading{font-size:100%;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Heading+.Section5>.Heading:first-child{margin-top:0}#sbo-rt-content .RenderAsSection6>.Heading{font-size:100%;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Heading+.Section6>.Heading:first-child{margin-top:0}#sbo-rt-content .RenderAsSection7>.Heading{font-size:100%;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .Heading+.Section7>.Heading:first-child{margin-top:0}#sbo-rt-content .Literal{font-family:"Courier New",Courier,monospace}#sbo-rt-content .OrderedList{margin-top:.5em;margin-bottom:.5em;text-indent:0;display:table}#sbo-rt-content .OrderedList>ol{margin:0;padding:0}#sbo-rt-content .OrderedList .Heading{font-size:1em;font-style:italic;font-weight:normal;margin-top:0;margin-bottom:0;display:table-caption}#sbo-rt-content .OrderedList .Heading+.ListItem{margin-top:0}#sbo-rt-content .Heading+.Para>div.OrderedList:first-child,#sbo-rt-content .Heading+.Para>div.OrderedList:first-child>.Heading{margin-top:0}#sbo-rt-content .ListItem{margin-top:.5em;display:table-row}#sbo-rt-content .ItemNumber{padding-right:.5em;display:table-cell;vertical-align:top}#sbo-rt-content .ItemContent{display:table-cell}#sbo-rt-content .Fulltext>.Para:first-of-type{border-top:1px solid #bbb;margin-top:1em;padding-top:1em}#sbo-rt-content .Fulltext>.Para~.Para:first-of-type{border-top:none;margin-top:0;padding-top:0}#sbo-rt-content .Para+.Para{margin-top:0;text-indent:1.5em}#sbo-rt-content .ParaTextBreak{margin-top:1em !important;text-indent:0 !important}#sbo-rt-content .ParaTypeExample{border-left:4px solid;padding-left:.5em;margin-top:1em !important;margin-bottom:1em}#sbo-rt-content .ParaTypeEyeCatcher,#sbo-rt-content .ParaTypeTip{border-left:4px solid;padding-left:.5em;margin-top:1em !important;margin-bottom:.5em}#sbo-rt-content .ParaTypeImportant{background:#bbb;border:2px solid;padding:.5em;margin-top:.8em !important;margin-bottom:.8em}#sbo-rt-content .ParaTypeImportant img{background-color:transparent}#sbo-rt-content .ParaTypeGeneticSequence,#sbo-rt-content .ParaTypeLiteral,#sbo-rt-content .ParaTypeProgramcode{font-family:"Courier New",Courier,monospace;font-size:95%}#sbo-rt-content .ParaTypeProgramcode{text-indent:0 !important;word-wrap:break-word}#sbo-rt-content .Para:not(.ParaTypeProgramcode)+.ParaTypeProgramcode{margin-top:.5em}#sbo-rt-content .ParaTypeProgramcode+.Para:not(.ParaTypeProgramcode){margin-top:.5em}#sbo-rt-content .ParaTypeLegalText{font-weight:bold;margin-left:1em;text-align:left}#sbo-rt-content .ParaTypeOverview,#sbo-rt-content .ParaTypeAnswers,#sbo-rt-content .ParaTypeQuestions,#sbo-rt-content .ParaTypeDefinition,#sbo-rt-content .ParaTypeProcedure,#sbo-rt-content .ParaTypeRecipe{border:2px solid;margin-top:.8em !important;margin-bottom:.8em;padding:.5em}#sbo-rt-content .ParaTypeSource{font-style:italic}#sbo-rt-content .ParaTypeTrailer,#sbo-rt-content .ParaTypeLearningGoals{font-weight:bold;padding-left:.5em;padding-right:.5em}#sbo-rt-content .ParaTypeWarning{font-weight:bold}#sbo-rt-content .ParaTypeExample,#sbo-rt-content .ParaTypeEyeCatcher,#sbo-rt-content .ParaTypeImportant,#sbo-rt-content .ParaTypeLegalText,#sbo-rt-content .ParaTypeOverview,#sbo-rt-content .ParaTypeTip,#sbo-rt-content .ParaTypeAnswers,#sbo-rt-content .ParaTypeQuestions,#sbo-rt-content .ParaTypeDefinition,#sbo-rt-content .ParaTypeProcedure,#sbo-rt-content .ParaTypeRecipe{text-indent:0 !important}#sbo-rt-content .Para+.ParaOneEmphasisChild{margin-top:1em;text-indent:0 !important}#sbo-rt-content .ParaOneEmphasisChild+.Para{text-indent:0 !important}#sbo-rt-content .PartNumber{display:block;font-size:1.73rem}#sbo-rt-content .PartTitle{display:block;font-size:1.73rem}#sbo-rt-content .SubPartTitle{display:block;font-size:1.44rem}#sbo-rt-content .ProgramCode{margin-top:1em;margin-bottom:1em}#sbo-rt-content .ProgramCode .FixedLine{font-family:"Courier New",Courier,monospace;font-size:95%;word-wrap:break-word}#sbo-rt-content .LineGroup+.LineGroup{margin-top:1em}#sbo-rt-content .Heading+.Para>.Quiz>.Heading{margin-top:0;}#sbo-rt-content .Quiz .Heading{font-size:1rem;margin-top:1em;margin-bottom:0;text-indent:0}#sbo-rt-content .QuizTask{display:table;margin-top:.5em;margin-bottom:.5em;width:100%;text-indent:0}#sbo-rt-content .QuizTask+.QuizTask{margin-top:1.5em}#sbo-rt-content .QuizItem{padding:.1em}#sbo-rt-content .QuizItemTypeSolution{border:2px solid #aaa;margin-top:.5em;padding:10px}#sbo-rt-content .QuizTask>input{display:none}#sbo-rt-content .QuizItem>label{color:#0176C3}#sbo-rt-content .QuizTask>input~.QuizItem>label+div{display:none}#sbo-rt-content .QuizTask>input:checked~.QuizItem>label+div{display:table-cell}#sbo-rt-content .QuizTask>input~.QuizItem>label:after{content:"  »"}#sbo-rt-content .QuizTask>input:checked~.QuizItem>label:after{content:"  «"}#sbo-rt-content .QuizTask>input~.QuizItemTypeCorrectAnswer{background-color:transparent;transition:background .4s}#sbo-rt-content .QuizTask>input:checked~.QuizItemTypeCorrectAnswer{background-color:#EAF2DB;transition:background .4s}#sbo-rt-content .ReviewTitle{font-weight:bold;margin-top:1em;text-indent:0}#sbo-rt-content .Review .AuthorName+.AuthorName:before{content:", "}#sbo-rt-content .Review .ISBN,#sbo-rt-content .ReviewDataUnstructured{text-indent:0}#sbo-rt-content .Review .Para:first-of-type{margin-top:1em;text-indent:0}#sbo-rt-content .BookBackmatter>.Appendix:first-child>div:first-child{border-top:none !important;margin-top:0 !important;padding-top:0 !important}#sbo-rt-content .BookAcknowledgmentsBody>.RenderAsSection1:first-child,#sbo-rt-content .BookNotesBody>.RenderAsSection1:first-child,#sbo-rt-content .ForewordBody>.RenderAsSection1:first-child,#sbo-rt-content .PrefaceBody>.RenderAsSection1:first-child,#sbo-rt-content .BookBackmatter>.Appendix:first-child>.RenderAsSection1:first-child{border-top:none;margin-top:0}#sbo-rt-content .BookAcknowledgmentsBody>.RenderAsSection1:first-child>.Heading,#sbo-rt-content .ForewordBody>.RenderAsSection1:first-child>.Heading,#sbo-rt-content .PrefaceBody>.RenderAsSection1:first-child>.Heading{margin-top:0}#sbo-rt-content .Section1 .AuthorNames,#sbo-rt-content .Section2 .AuthorNames,#sbo-rt-content .Section3 .AuthorNames{font-weight:bold;margin-top:.3em;margin-bottom:.5em}#sbo-rt-content .Section1 .AuthorNames sup,#sbo-rt-content .Section2 .AuthorNames sup,#sbo-rt-content .Section3 .AuthorNames sup{font-size:70%}#sbo-rt-content .Section1 .Affiliations,#sbo-rt-content .Section2 .Affiliations,#sbo-rt-content .Section3 .Affiliations{margin-bottom:.5em}#sbo-rt-content .SectionTypeBackgroundInformation,#sbo-rt-content .SectionTypeExcurse{font-size:90%}#sbo-rt-content .SectionTypeBox,#sbo-rt-content .SectionTypeOverview,#sbo-rt-content .SectionTypeQuestionnaire{background-color:#BBB;margin-top:1em !important;padding:.5em}#sbo-rt-content .SectionTypeCaseStudy,#sbo-rt-content .SectionTypeExample,#sbo-rt-content .SectionTypeTip{border-left:4px solid;margin-top:1em !important;padding-top:0;padding-left:.5em;padding-right:.5em;padding-bottom:.5em}#sbo-rt-content .SectionTypeTrailer,#sbo-rt-content .SectionTypeLearningGoals{font-weight:bold;text-align:left}#sbo-rt-content .SectionTypeLegalText{font-weight:bold;margin-left:1em;text-align:left;text-indent:0 !important}#sbo-rt-content .SectionTypeProcedure,#sbo-rt-content .SectionTypeRecipe{border:2px solid;margin-top:.8em !important;margin-bottom:.8em;padding:.5em}#sbo-rt-content .SectionTypeWarning{font-weight:bold}#sbo-rt-content .RenderAsSection1{border-top:1px solid #bbb;margin-top:1em}#sbo-rt-content .SectionTypeBox+.RenderAsSection1,#sbo-rt-content .SectionTypeOverview+.RenderAsSection1,#sbo-rt-content .SectionTypeQuestionnaire+.RenderAsSection1{border-top:0;}#sbo-rt-content .SectionTypeBox>.Heading,#sbo-rt-content .SectionTypeOverview>.Heading,#sbo-rt-content .SectionTypeQuestionnaire>.Heading,#sbo-rt-content .SectionTypeProcedure>.Heading,#sbo-rt-content .SectionTypeRecipe>.Heading{margin-top:0}#sbo-rt-content .InternalRefSidebarLexicon{background-image:url(sidebar.gif);background-repeat:no-repeat;font-weight:bold;padding-left:20px}#sbo-rt-content .SidebarDialog{border:1px solid;margin-left:1.5em;margin-top:.4em;margin-bottom:.2em;padding:.2em;text-indent:0}#sbo-rt-content .SidebarNumber{font-weight:bold;padding-right:.5em}#sbo-rt-content .SimplePara+.SimplePara{margin-top:0;text-indent:1.5em}#sbo-rt-content .Stack{display:inline-table;vertical-align:top}#sbo-rt-content .Stack sub{display:table-row}#sbo-rt-content .Stack sup{display:table-header-group}#sbo-rt-content table{border-collapse:collapse;font-size:80%;max-width:100%;text-indent:0}#sbo-rt-content table .SimplePara+.SimplePara{text-indent:0}#sbo-rt-content table,#sbo-rt-content tr,#sbo-rt-content td{border-color:#bbb !important}#sbo-rt-content th{border-color:#999 !important}#sbo-rt-content thead{background:#bbb;color:#000 !important}#sbo-rt-content .Table{margin-bottom:1em;text-indent:0}#sbo-rt-content .Caption .Table{margin-bottom:0}#sbo-rt-content .Table img{height:auto;margin:0;max-width:100%}#sbo-rt-content th div{text-align:left}#sbo-rt-content td div,#sbo-rt-content td p,#sbo-rt-content th div,#sbo-rt-content th p{padding:.2em}#sbo-rt-content .Para+.Table,#sbo-rt-content .Para>.Table{margin-top:1em}#sbo-rt-content .SimplePara>.Table{margin-top:.5em}#sbo-rt-content thead,#sbo-rt-content tdiv{vertical-align:top}#sbo-rt-content tbody+tbody tr:first-child td{padding-top:1em}#sbo-rt-content .ExternalTable{background-color:#F8F8F8;border-top:1px solid;border-bottom:1px solid;margin-top:1em;margin-bottom:1em;padding-top:0;padding-bottom:0}#sbo-rt-content .ExternalTable .Table{padding-bottom:.3em}#sbo-rt-content .UnorderedList>.Heading{font-size:1em;font-style:italic;font-weight:normal;margin-top:0;margin-bottom:0}#sbo-rt-content .Heading+.Para>div.UnorderedList:first-child>.Heading{margin-top:0}#sbo-rt-content .UnorderedList li .Para:first-child{text-indent:0}#sbo-rt-content .Heading+ul{margin-top:0}#sbo-rt-content ul{margin-top:.5em;margin-bottom:.5em}#sbo-rt-content ul.UnorderedListMarkBullet{list-style-type:disc;padding-left:1em}#sbo-rt-content ul.UnorderedListMarkBullet div{margin-bottom:.3em}#sbo-rt-content ul.UnorderedListMarkBullet .Equation div{margin-bottom:0}#sbo-rt-content ul.UnorderedListMarkNone{list-style-type:none;padding-left:1em}#sbo-rt-content ul.UnorderedListMarkNone div{margin-bottom:.3em}#sbo-rt-content ul.UnorderedListMarkNone .Equation div{margin-bottom:0}#sbo-rt-content ul.UnorderedListMarkDash{list-style:none;padding-left:1.1em;text-indent:-.8em}#sbo-rt-content ul.UnorderedListMarkDash>li>*:first-child{display:inline}#sbo-rt-content ul.UnorderedListMarkDash div{text-indent:0;margin-top:.3em;margin-bottom:.3em}#sbo-rt-content ul.UnorderedListMarkDash>li:before{content:"– "}#sbo-rt-content .Verse{margin-top:1em;margin-bottom:1em}#sbo-rt-content .Verse .Heading{font-size:1rem;margin-top:1em;margin-bottom:1em;text-indent:0}#sbo-rt-content .Acknowledgments,#sbo-rt-content .AuthorContribution,#sbo-rt-content .Ethics{margin-top:1em}#sbo-rt-content .Acknowledgments>.Heading,#sbo-rt-content .AuthorContribution>.Heading,#sbo-rt-content .FundingInformation>.Heading,#sbo-rt-content .DataAvailability>.Heading,#sbo-rt-content .Ethics>.Heading{font-size:1.2rem;margin-bottom:0}#sbo-rt-content .License{font-size:.9rem !important;margin-top:1em;margin-bottom:1em}#sbo-rt-content .License>a:first-child img{float:left;height:1.9rem;padding-right:.5em;padding-bottom:0;padding-top:.2em}#sbo-rt-content .Glossary{border-top:1px solid #bbb;margin-top:1em;margin-bottom:1em;padding-top:.3em}#sbo-rt-content .Glossary .Headings{margin-top:.8em;margin-bottom:.8em}#sbo-rt-content .Glossary>.Headings>.Heading{font-size:1.44rem;margin:0}#sbo-rt-content .Glossary>.Headings>.SubHeading{font-size:1.2rem}#sbo-rt-content .GlossarySection .Headings{margin-top:.8em;margin-bottom:.4em}#sbo-rt-content .GlossarySection>.Headings>.Heading{font-size:1.2rem;margin:0}#sbo-rt-content .GlossarySection>.Headings>.SubHeading{font-size:100%}#sbo-rt-content .GlossaryTerm{float:left;font-style:italic;padding-right:.5em}#sbo-rt-content .GlossarySeeLabel,#sbo-rt-content .GlossarySeeAlsoLabel{font-style:italic;padding-right:.3em}#sbo-rt-content .GlossaryDef{display:inline;margin-top:.3em}#sbo-rt-content .GlossaryDef>.SimplePara,#sbo-rt-content .GlossaryDef>.GlossarySee,#sbo-rt-content .GlossaryDef>.GlossarySeeAlso{display:block}#sbo-rt-content .GlossaryDef>:first-child{display:inline;margin-top:0;margin-left:0}#sbo-rt-content .GlossaryDef .SimplePara+.GlossarySee,#sbo-rt-content .GlossaryDef .SimplePara+.GlossarySeeAlso{text-indent:0}#sbo-rt-content .GlossaryTerm{display:inline}#sbo-rt-content .GlossaryTerm+.GlossarySee,#sbo-rt-content .GlossaryTerm+.GlossarySeeAlso{display:inline}#sbo-rt-content .InternalRefGlossaryEntry{border-bottom:thin dotted;cursor:help}#sbo-rt-content .InternalRefGlossaryEntry:hover{border-bottom:none}#sbo-rt-content .InternalRefGlossaryEntry a:link,#sbo-rt-content .InternalRefGlossaryEntry a:active,#sbo-rt-content .InternalRefGlossaryEntry a:visited{color:inherit}#sbo-rt-content .InternalRefGlossaryEntry .InlineGlossaryDefinition{background:#fff;display:none;margin:0 3em 0 2em;padding:3px 3px 3px 6px;border-style:solid;border-color:#49546F;border-width:2px;border-radius:5px;box-shadow:5px 5px 5px #888}#sbo-rt-content .InternalRefGlossaryEntry:hover .InlineGlossaryDefinition{display:block;z-index:6}#sbo-rt-content .TocAppendix{border-top:1px solid #bbb;margin-top:1em;padding-top:1em}#sbo-rt-content .BookContextInformation+.Appendix>.TocAppendix:first-child{border-top:none;padding-top:0}#sbo-rt-content .TocAppendix .Headings{margin-bottom:.5em}#sbo-rt-content .TocAppendix>.Headings>.Heading{font-size:1.44rem;margin:0}#sbo-rt-content .TocAppendix>.Headings>.SubHeading{font-size:1.2rem}#sbo-rt-content .TocEntry,#sbo-rt-content .TocPart,#sbo-rt-content .TocBack{margin-top:.5em;text-align:left !important}#sbo-rt-content .TocItem{font-weight:bold}#sbo-rt-content .TocPageNumber{display:none}#sbo-rt-content .TocAuthors{padding-left:1.5em}#sbo-rt-content .TocSection1,#sbo-rt-content .TocSection2,#sbo-rt-content .TocSection3,#sbo-rt-content .TocSection4,#sbo-rt-content .TocSection5,#sbo-rt-content .TocSection6,#sbo-rt-content .TocSection7{padding-left:1.5em}#sbo-rt-content .Index{border-top:1px solid #bbb;margin-top:1em;padding-top:.3em;margin-bottom:.8em}#sbo-rt-content .BookBackmatter>.Index:first-child{border-top:none;margin-top:0}#sbo-rt-content .Index .Headings{margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .BookBackmatter>.Index:first-child>.Headings{margin-top:0}#sbo-rt-content .Index>.Headings>.Heading{font-size:1.44rem;margin:0}#sbo-rt-content .Index>.Headings>.SubHeading{font-size:1.2rem}#sbo-rt-content .IndexDiv .Headings{margin-top:.5em;margin-bottom:.1em}#sbo-rt-content .IndexDiv>.Headings>.Heading{font-size:1.2rem;margin:0}#sbo-rt-content .IndexDiv>.Headings>.SubHeading{font-size:100%;font-style:italic}#sbo-rt-content .IndexEntrySeeLabel{font-style:italic;margin-left:1em;padding-right:.3em}#sbo-rt-content .SecondaryIE{margin-left:1em}#sbo-rt-content .TertiaryIE{margin-left:2em}#sbo-rt-content .ChangeHistory{border-top:1px solid #bbb;margin-top:1em}#sbo-rt-content .ChangeHistory>.Heading{font-size:1.44rem;margin-top:.8em;margin-bottom:.3em}#sbo-rt-content .ChangeDate{font-weight:bold;padding-right:1em}#sbo-rt-content .ChangeDetails{display:inline}#sbo-rt-content .ChangeDetails>p:first-of-type{display:inline}#sbo-rt-content .Bibliography{border-top:1px solid #bbb;margin-top:1em}#sbo-rt-content .BookBackmatter>.Bibliography:first-child{border-top:none}#sbo-rt-content .Bibliography>.Heading{font-size:1.44rem;margin-top:.8em;margin-bottom:.1em}#sbo-rt-content .BibliographyWrapper{display:table;margin:0;padding:0}#sbo-rt-content .Bibliography>.BibliographyWrapper{padding-top:1em}#sbo-rt-content .Bibliography>.Heading+.BibliographyWrapper{padding-top:0}#sbo-rt-content .BibSection>.Heading{font-size:1.2rem;margin-top:.8em;margin-bottom:.2em}#sbo-rt-content .BibliographyWrapper>.BibSection:first-child>.Heading:first-child{margin-top:.3em}#sbo-rt-content .Citation{display:table-row;font-size:90%}#sbo-rt-content .CitationNumber{display:table-cell}#sbo-rt-content .CitationNumber+.CitationContent{padding-left:.5em;text-align:left}#sbo-rt-content .CitationContent{padding-top:1em;display:table-cell}#sbo-rt-content .BibliographyWrapper>.Citation:first-child>.CitationContent{padding-top:0}#sbo-rt-content .Occurrences{display:block}#sbo-rt-content .Occurrence{margin-right:0}#sbo-rt-content .Occurrence:before{content:"["}#sbo-rt-content .Occurrence:after{content:"]"}#sbo-rt-content .Citation .ArticleTitle:before,#sbo-rt-content .Citation .ChapterTitle:before{content:" “";}#sbo-rt-content .Citation .ArticleTitle,#sbo-rt-content .Citation .ChapterTitle{display:inline}#sbo-rt-content .Citation .ArticleTitle:after{content:"”\ ";}#sbo-rt-content .Citation .ChapterTitle:after{content:"”\ In: ";}#sbo-rt-content .Citation .Year:before{content:" ("}#sbo-rt-content .Citation .Year:after{content:") "}#sbo-rt-content .Citation .JournalTitle:after{content:" "}#sbo-rt-content .Citation .VolumeID:after{content:":"}#sbo-rt-content .BibChapter .FirstPage:before,#sbo-rt-content .BibBook .FirstPage:before{content:", pp "}#sbo-rt-content .Citation .FirstPage+.LastPage:before{content:"–";}#sbo-rt-content .Citation .BookTitle:after,#sbo-rt-content .Citation .BibEditorName:after,#sbo-rt-content .Citation .EditionNumber:after,#sbo-rt-content .Citation .PublisherName:after{content:", "}#sbo-rt-content .BibComments{display:block}#sbo-rt-content .CoverFigure img{margin:0 auto 6px;width:100%;max-width:480px;height:auto}#sbo-rt-content .SeriesTitlePage{padding-bottom:1.5em;padding-top:1em}#sbo-rt-content .SeriesTitlePage .VolumeNumber{font-size:1.44rem}#sbo-rt-content .SeriesTitlePage span.SeriesTitle{display:block;font-size:1.73rem;font-weight:bold;margin-top:.5em}#sbo-rt-content .SeriesTitlePage .SeriesSubTitle{display:block;font-size:1.44rem;font-weight:bold}#sbo-rt-content .SeriesTitlePage .SubSeriesTitle{display:block;font-size:1.44rem;font-weight:bold;margin-top:.5em}#sbo-rt-content .SeriesTitlePage .SubSeriesSubTitle{display:block;font-size:1.2rem;font-weight:bold}#sbo-rt-content .SeriesTitlePage .CollaboratorDesignation{display:block;font-weight:bold;padding-top:3em}#sbo-rt-content .SeriesTitlePage .Collaborators{display:block}#sbo-rt-content .SeriesTitlePage .AffiliationText{font-style:italic;margin-left:0}#sbo-rt-content .SeriesTitlePage .Affiliation+.CollaboratorName{display:inline-block;margin-top:1em}#sbo-rt-content .SeriesInformationText{padding-top:3em}#sbo-rt-content .BookTitlePage{padding-top:1em}#sbo-rt-content .BookTitlePageAfterSeriesTitlePage{border-top:1px solid #bbb;page-break-before:always}#sbo-rt-content .BookContextInformation+.BookTitlePage{border-top:none;padding-top:0}#sbo-rt-content .BookTitlePage .BookEditors,#sbo-rt-content .BookTitlePage .BookAuthors,#sbo-rt-content .BookTitlePage .BookEditorInChiefGroup,#sbo-rt-content .BookTitlePage .BookSectionEditorGroup{text-align:left !important}#sbo-rt-content .BookTitlePage .BookEditorInChiefGroup,#sbo-rt-content .BookTitlePage .BookSectionEditorGroup{margin-top:1em}#sbo-rt-content .BookTitlePage .BookEditorGroup .CollaboratorDesignation,#sbo-rt-content .BookTitlePage .BookEditorInChiefGroup .CollaboratorDesignation,#sbo-rt-content .BookTitlePage .BookSectionEditorGroup .CollaboratorDesignation{font-style:italic}#sbo-rt-content .BookTitlePage .BookTitle{display:block;font-size:1.73rem;font-weight:bold;margin-top:1em}#sbo-rt-content .BookTitlePage .BookSubTitle{display:block;font-size:1.44rem;font-weight:bold;margin-bottom:.5em}#sbo-rt-content .BookTitlePage .BookEdition{display:block;font-size:1rem;font-weight:normal;margin-top:.5em}#sbo-rt-content .BookTitlePage .CollaboratorLine{padding-top:.5em}#sbo-rt-content .BookFeatureText{margin-top:.5em}#sbo-rt-content .BookTitlePage .PublisherLogo .Figure,#sbo-rt-content .BookTitlePage .PublisherImprintName{font-size:1.2rem;margin-top:4em;margin-bottom:1.5em;text-align:left}#sbo-rt-content .CopyrightPage{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .CopyrightPage .CollaboratorDesignation{display:block;font-style:italic;padding-bottom:.5em}#sbo-rt-content .CopyrightPageOriginators{padding-bottom:4em}#sbo-rt-content .CopyrightPage div+.CollaboratorDesignation{padding-top:2em}#sbo-rt-content .CopyrightPage .EditorGroup+.AuthorGroup{padding-top:2em}#sbo-rt-content .CopyrightPage .Author+.Author,#sbo-rt-content .CopyrightPage .Author+.InstitutionalAuthor,#sbo-rt-content .CopyrightPage .InstitutionalAuthor+.Author,#sbo-rt-content .CopyrightPage .InstitutionalAuthor+.InstitutionalAuthor,#sbo-rt-content .CopyrightPage .Editor+.Editor,#sbo-rt-content .CopyrightPage .Editor+.InstitutionalEditor,#sbo-rt-content .CopyrightPage .InstitutionalEditor+.Editor,#sbo-rt-content .CopyrightPage .InstitutionalEditor+.InstitutionalEditor,#sbo-rt-content .CopyrightPage .Collaborator+.Collaborator{padding-top:1em}#sbo-rt-content .CopyrightPage .Affiliation{margin-top:0}#sbo-rt-content .CopyrightPage .AffiliationText{margin-left:0}#sbo-rt-content .CopyrightPage .CollaboratorLine{padding-top:1em}#sbo-rt-content .CopyrightPage .CollaboratorLineTranslatedBy{padding-top:2em}#sbo-rt-content .CopyrightPage .CollaboratorLine .CollaboratorDesignation{display:inline;font-style:normal}#sbo-rt-content .BookFrontmatter .CopyrightPage .ArticleNoteESMHint,#sbo-rt-content .BookFrontmatter .CopyrightPage .ArticleNoteMoreMedia{border:none;padding-bottom:0;page-break-before:auto}#sbo-rt-content .CopyrightPageISBNs,#sbo-rt-content .CopyrightPageISSNs,#sbo-rt-content .SpringerLocationsLine,#sbo-rt-content .CatalogingInformation,#sbo-rt-content .MathematicsSubjectClassification,#sbo-rt-content .CopyrightLine,#sbo-rt-content .CopyrightPage .CopyrightComment,#sbo-rt-content .BookCopublishingInformation .SimplePara,#sbo-rt-content .CopyrightStandardText,#sbo-rt-content .TrademarkQualifierText,#sbo-rt-content .ProductLiability,#sbo-rt-content .LegalNotice,#sbo-rt-content .CoverDesigner,#sbo-rt-content .BookCoverFigureText,#sbo-rt-content .PaperInfo,#sbo-rt-content .SpringerReferenceLine{margin-top:1em}#sbo-rt-content .CopyrightComment+.CopyrightLine{margin-top:.5em}#sbo-rt-content .SeriesTitle+.CopyrightPageISBNs,#sbo-rt-content .SubSeriesTitle+.CopyrightPageISBNs{margin-top:0}#sbo-rt-content .CopyrightPage .SeriesTitle{display:block;margin-top:1em}#sbo-rt-content .SeriesTitle+.CopyrightPageISSNs,#sbo-rt-content .CopyrightPageISSNs+.SeriesTitle,#sbo-rt-content .CopyrightPageISSNs+.SubSeriesTitle{margin-top:0}#sbo-rt-content .CopyrightPagePrintISSN,#sbo-rt-content .CopyrightPagePrintISBN{display:inline-block;min-width:12em}#sbo-rt-content .SpringerReferenceLine .SimplePara+.SimplePara,#sbo-rt-content .BookCoverFigureText .SimplePara+.SimplePara,#sbo-rt-content .BookCopublishingInformation .SimplePara+.SimplePara{text-indent:0}#sbo-rt-content .CopyrightPagePrintISSN+.CopyrightPageElectronicISSN{padding-left:1.5em}#sbo-rt-content .CopyrightPagePrintISBN+.CopyrightPageElectronicISBN{padding-left:1.5em}#sbo-rt-content .CopyrightComment .SimplePara+.SimplePara{padding-top:.5em;text-indent:0}#sbo-rt-content .BookCorrectionYear:before{content:", "}#sbo-rt-content .BookCorrectionYear .Year:first-of-type:before{content:" "}#sbo-rt-content .BookCorrectionYear .Year+.Year:before{content:", "}#sbo-rt-content .MathematicsSubjectClassificationCode+.MathematicsSubjectClassificationCode:before{content:", "}#sbo-rt-content .Endorsement{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .Frontispiece{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .Dedication{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .Foreword{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .PartFrontmatter h1:first-child+.Foreword{border-top:none;padding-top:0;page-break-before:auto}#sbo-rt-content .ForewordTitle{font-size:1.44rem;font-weight:bold;padding-bottom:.1em;page-break-after:avoid}#sbo-rt-content .Foreword .AuthorName{margin-top:.2em}#sbo-rt-content .Foreword .AuthorName,#sbo-rt-content .ForewordLocations,#sbo-rt-content .ForewordDate{font-weight:bold;text-align:right}#sbo-rt-content .ForewordLocation+.ForewordLocation:before{content:", "}#sbo-rt-content .Foreword .RenderAsSection1>.Heading{font-size:1.2rem}#sbo-rt-content .Foreword .RenderAsSection2>.Heading,#sbo-rt-content .Foreword .RenderAsSection3>.Heading{font-size:100%}#sbo-rt-content .Preface{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .PrefaceTitle{font-size:1.44rem;font-weight:bold;padding-bottom:.1em;page-break-after:avoid}#sbo-rt-content .Preface .AuthorName{margin-top:.2em}#sbo-rt-content .Preface .AuthorName,#sbo-rt-content .PrefaceLocations,#sbo-rt-content .PrefaceDate{font-weight:bold;text-align:right}#sbo-rt-content .PrefaceLocation+.PrefaceLocation:before{content:", "}#sbo-rt-content .Preface .RenderAsSection1>.Heading{font-size:1.2rem}#sbo-rt-content .Preface .RenderAsSection2>.Heading,#sbo-rt-content .Preface .RenderAsSection3>.Heading{font-size:100%}#sbo-rt-content .BookFrontmatterArticleNote{border-top:1px solid #bbb;margin-top:0;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .PartFrontmatter .ArticleNote{padding-bottom:1em}#sbo-rt-content .PartFrontmatter h1:first-child+.ArticleNote{border-top:none;page-break-before:auto}#sbo-rt-content .BookFrontmatter .ArticleNote .Heading,#sbo-rt-content .PartFrontmatter .ArticleNote .Heading{font-size:1.44rem;font-style:normal;padding-bottom:.1em;page-break-after:avoid}#sbo-rt-content .BookAcknowledgments{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .BookAcknowledgmentsTitle{font-size:1.44rem;font-weight:bold;padding-bottom:.1em;page-break-after:avoid}#sbo-rt-content .BookAcknowledgments .AuthorName{font-weight:bold;margin-top:1em}#sbo-rt-content .BookAcknowledgments .RenderAsSection1>.Heading{font-size:1.2rem}#sbo-rt-content .BookAcknowledgments .RenderAsSection2>.Heading,#sbo-rt-content .BookAcknowledgments .RenderAsSection3>.Heading{font-size:100%}#sbo-rt-content .BookNotes{border-top:1px solid #bbb;padding-top:1em;padding-bottom:1em;page-break-before:always}#sbo-rt-content .BookNotesTitle{font-size:1.44rem;font-weight:bold;margin-bottom:.1em;page-break-after:avoid}#sbo-rt-content .BookNotes .AuthorName{font-weight:bold}#sbo-rt-content .BookFrontmatterAbbreviationGroup{border-top:1px solid #bbb;margin-top:0;padding-bottom:1em;page-break-before:always}#sbo-rt-content .PartFrontmatter .AbbreviationGroup{padding-bottom:1em;margin-top:1em}#sbo-rt-content .BookFrontmatter .AbbreviationGroup .Heading,#sbo-rt-content .PartFrontmatter .AbbreviationGroup .Heading{font-size:1.44rem;font-weight:bold;padding-top:1em;padding-bottom:.1em;page-break-after:avoid}#sbo-rt-content .BookFrontmatter .AbbreviationGroupSection>.Heading,#sbo-rt-content .PartFrontmatter .AbbreviationGroupSection>.Heading{font-size:1.2rem;padding-top:1em;padding-bottom:0}#sbo-rt-content .BookFrontmatter .AbbreviationGroupSection+.AbbreviationGroupSection>.Heading,#sbo-rt-content .PartFrontmatter .AbbreviationGroupSection+.AbbreviationGroupSection>.Heading{padding-top:.5em}#sbo-rt-content .Toc{border-top:1px solid #bbb;margin-top:0;padding-bottom:1em;page-break-before:always}#sbo-rt-content .Toc .Headings{margin-bottom:.5em}#sbo-rt-content .Toc>.Headings>.Heading{font-size:1.44rem;margin:0}#sbo-rt-content .Toc>.Headings>.SubHeading{font-size:1.2rem}#sbo-rt-content .Loh{border-top:1px solid #bbb;padding-bottom:1em;padding-top:1em;page-break-before:always}#sbo-rt-content .Loh .Headings{margin-bottom:.1em}#sbo-rt-content .Loh>.Headings>.Heading{font-size:1.44rem;margin:0}#sbo-rt-content .Loh>.Headings>.SubHeading{font-size:1.2rem}#sbo-rt-content .LohPageNumber{display:none}#sbo-rt-content .LocWithHeading,#sbo-rt-content .LocWithoutHeading>.LocBody>.LocDiv{border-top:1px solid #bbb;padding-bottom:1em;padding-top:1em;page-break-before:always}#sbo-rt-content .Loc .Headings{margin-bottom:.1em}#sbo-rt-content .LocWithHeading>.Headings>.Heading,#sbo-rt-content .LocWithoutHeading>.LocBody>.LocDiv>.Headings>.Heading{font-size:1.44rem;margin:0}#sbo-rt-content .LocWithHeading>.Headings>.SubHeading,#sbo-rt-content .LocWithoutHeading>.LocBody>.LocDiv>.Headings>.SubHeading{font-size:1.2rem}#sbo-rt-content .LocWithHeading .LocDiv{margin-top:1em}#sbo-rt-content .LocWithHeading .LocDiv .Heading{font-size:1.2rem;margin-bottom:.1em}#sbo-rt-content .LocWithHeading .LocDiv .SubHeading{font-size:100%;font-style:italic;font-weight:normal}#sbo-rt-content .LocDiv .FormalPara .Heading{font-size:100%}#sbo-rt-content .Loc .AuthorGroup+.AuthorGroup,#sbo-rt-content .Loc .AuthorGroup+.EditorGroup,#sbo-rt-content .Loc .EditorGroup+.AuthorGroup,#sbo-rt-content .Loc .EditorGroup+.EditorGroup{margin-top:1em}#sbo-rt-content .Loc .Author,#sbo-rt-content .Loc .Editor,#sbo-rt-content .Loc .InstitutionalAuthor,#sbo-rt-content .Loc .InstitutionalEditor{font-weight:bold}#sbo-rt-content .Loc .AffiliationText{margin-left:0}#sbo-rt-content .Loc .Email+.Email:before{content:", "}#sbo-rt-content .Loc .Emails,#sbo-rt-content .Loc .URLs{display:inline}#sbo-rt-content .Loc .Emails+.URLs:before{content:", "}#sbo-rt-content .Loc .URL+.URL:before{content:", "}#sbo-rt-content .BookFrontmatterFootnoteSection{border-top:1px solid #bbb;margin-top:0;page-break-before:always}#sbo-rt-content .PartFrontmatter .FootnoteSection{border-top:none;margin-top:0}#sbo-rt-content .Colophon{border-top:1px solid #bbb;margin-top:1em;padding-top:.8em;font-style:italic}#sbo-rt-content .ConferenceInfo{border-top:1px solid #bbb;margin-top:1em;padding-top:.8em}#sbo-rt-content .ConfEventAbbreviation,#sbo-rt-content .ConfNumber+.ConfSeriesName,#sbo-rt-content .ConfEventAbbreviation+.Year,#sbo-rt-content .ConfEventDateStart,#sbo-rt-content .ConfEventDateEnd{display:inline}#sbo-rt-content .ConfEventAbbreviation:after{content:" "}#sbo-rt-content .ConfEventLocation .City:after{content:", "}#sbo-rt-content .ConfEventDateEnd:before{content:"–"}#sbo-rt-content .ConfEventDateStart .Year:after,#sbo-rt-content .ConfEventDateStart .Month:after,#sbo-rt-content .ConfEventDateEnd .Year:after,#sbo-rt-content .ConfEventDateEnd .Month:after{content:"/"}#sbo-rt-content .ConfEventDate .Month:after{content:"/"}
    </style><script id="twitter-wjs" src="https://platform.twitter.com/widgets.js"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/cool-2.1.15.min.下载"></script><script crossorigin="anonymous" integrity="sha256-4akcsqklmUmtNjRgapND1hbNA1NRfbSO24PnriCCqNI=" type="text/javascript" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/appcues.main.37.下载" async=""></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/ec.js.下载"></script><script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/443792972845831" async=""></script><script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/1732687426968531" async=""></script><script async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/fbevents.js.下载"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/f.txt"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/analytics.js.下载"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/bat.js.下载"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/f.txt"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/insight.min.js.下载"></script><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/f.txt"></script><script async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/gtm.js.下载"></script><script> // <![CDATA[
    var g = {
      position_cache: {
        
          "chapter": "/api/v1/book/9781484245019/chapter/html/477630_1_En_12_Chapter.xhtml",
          "book_id": "9781484245019",
          "chapter_uri": "html/477630_1_En_12_Chapter.xhtml",
          "position": 0,
          "user_uuid": "6d9ee17b-34b1-4bf4-bdae-19676bd84ca1",
          "next_chapter_uri": "/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_13_Chapter.xhtml"
        
      },
      title: "Practical Microservices Architectural Patterns: Event\u002DBased Java Microservices with Spring Boot and Spring Cloud",
      author_list: "Binildas Christudas",
      format: "book",
      source: "application/epub+zip",
      is_system_book: true,
      is_public: false,
      loaded_from_server: true,
      allow_scripts: false,
      has_mathml: false
    };
    // ]]></script><script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/modernizr.8e354.下载"></script><script>
    
      

      
        
          window.PUBLIC_ANNOTATIONS = true;
        
      

      window.MOBILE_PUBLIC_ANNOTATIONS = false;

    

    
      window.PRIVACY_CONTROL_OVERRIDE = false;
    

      window.PRIVACY_CONTROL_SWITCH = true;

      window.PUBLISHER_PAGES = true;

      window.SBO = {
        "constants": {
          "SITB_ENDPOINT": "/api/v2/sitb/",
          "SEARCH_SELECT_ENDPOINT": "https://learning.oreilly.com/api/v2/search/select/",
          "ENABLE_ONLINE_TRAINING": true
        }
      };
  </script><link rel="canonical" href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml"><meta name="description" content="© Binildas Christudas 2019 Binildas ChristudasPractical Microservices Architectural Patternshttps://doi.org/10.1007/978-1-4842-4501-9_12 12. Axon for CQRS Architecture Binildas Christudas1  (1)Trivandrum, Kerala, India   In Chapter 11, you learned about ...!--end&gt;!--begin&gt; "><meta property="og:title" content="12. Axon for CQRS Architecture"><meta itemprop="isPartOf" content="/library/view/practical-microservices-architectural/9781484245019/"><meta itemprop="name" content="12. Axon for CQRS Architecture"><meta property="og:url" itemprop="url" content="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml"><meta property="og:site_name" content="Safari"><meta property="og:image" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781484245019/"><meta property="og:description" itemprop="description" content="© Binildas Christudas 2019 Binildas ChristudasPractical Microservices Architectural Patternshttps://doi.org/10.1007/978-1-4842-4501-9_12 12. Axon for CQRS Architecture Binildas Christudas1  (1)Trivandrum, Kerala, India   In Chapter 11, you learned about ...!--end&gt;!--begin&gt; "><meta itemprop="inLanguage" content="en"><meta itemprop="publisher" content="Apress"><meta property="og:type" content="book"><meta property="og:book:isbn" itemprop="isbn" content="9781484245019"><meta property="og:book:author" itemprop="author" content="Binildas Christudas"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@OReillyMedia"><style type="text/css" id="font-styles" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-size: &lt;%= font_size %&gt; !important; }"></style><style type="text/css" id="font-family" data-template="#sbo-rt-content, #sbo-rt-content p, #sbo-rt-content div { font-family: &lt;%= font_family %&gt; !important; }"></style><style type="text/css" id="column-width" data-template="#sbo-rt-content { max-width: &lt;%= column_width %&gt;% !important; margin: 0 auto !important; }"></style><noscript><meta http-equiv="refresh" content="0; url=/library/no-js/" /></noscript><script>
    var dataLayer = window.dataLayer || [];

    
      window.medalliaVsgUserIdentifier = '6d9ee17b-34b1-4bf4-bdae-19676bd84ca1';
      dataLayer.push({userIdentifier: '6d9ee17b-34b1-4bf4-bdae-19676bd84ca1'});
      dataLayer.push({loggedIn: 'yes'});

      
        window.medalliaVsgAccountIdentifier = '20b4a98e-dfa5-4bb6-bdfb-97a15a9c3f0d';
        
        dataLayer.push({orgID: '20b4a98e-dfa5-4bb6-bdfb-97a15a9c3f0d'});
        

        window.medalliaVsgIsIndividual = false;
        
          
          dataLayer.push({learningAccountType: 'enterprise'});
          
        

        
          dataLayer.push({learningPaidAccount: 'yes'});
        
      
    

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5P4V6Z');
    (function () {
      var VERSION = 'V1.1';
      var AUTHOR = 'Awwad';
      if (!window.GtmHelper)
        window.GtmHelper = function () {
          var instance = this;
          var loc = document.location;
          this.version = VERSION;
          this.author = AUTHOR;
          this.readCookie = function (name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
              var c = ca[i];
              while (c.charAt(0) == ' ') c = c.substring(1, c.length);
              if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
          };
          this.createCookie = function (name, value, days, cookieDomain) {
            var domain = "";
            var expires = "";

            if (days) {
              var date = new Date();
              date.setTime(date.getTime() + Math.ceil(days * 24 * 60 * 60 * 1000));
              var expires = " expires=" + date.toGMTString() + ";";
            }

            if (typeof (cookieDomain) != 'undefined')
              domain = " domain=" + cookieDomain + "; ";

            document.cookie = name + "=" + value + ";" + expires + domain + "path=/";
          };

          this.isDuplicated = function (currentTransactionId) {
            // the previous transaction id:
            var previousTransIdValue = this.readCookie("previousTransId");

            if (currentTransactionId === previousTransIdValue) {
              return true; // Duplication
            } else {
              return false;
            }
          };
        }
    })()
  </script><script defer="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/vendor.a7a9eda7.下载"></script><script defer="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/reader.90cfcafc.下载"></script><script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/f(1).txt"></script><script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/f(2).txt"></script><script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/f(3).txt"></script><iframe src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/saved_resourc.html"></iframe><iframe src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/saved_r(1).html"></iframe><iframe src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/saved_r(2).html"></iframe><link rel="stylesheet" type="text/css" integrity="sha256-m9iQXscob5jO+vyfe0sovuV3lxwPoNxtAuVQYG3yl4o=" crossorigin="anonymous" href="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/container.37d7.css"><iframe src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/saved_r(3).html"></iframe><script async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/MathJax.js.下载"></script><style id="annotator-dynamic-style">.annotator-adder, .annotator-outer, .annotator-notice {
  z-index: 100019;
}
.annotator-filter {
  z-index: 100009;
}</style><style type="text/css" id="kampyleStyle">.noOutline{outline: none !important;}.wcagOutline:focus{outline: 1px dashed #595959 !important;outline-offset: 2px !important;transition: none !important;}</style></head>


<body class="reading sidenav nav-collapsed  scalefonts library">

    
  <noscript> 
    <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
            height="0" width="0"
            style="display:none;visibility:hidden">
    </iframe>
  </noscript>



    
      <div class="hide working" role="status">
        <div class="working-image"></div>
      </div>
      <div class="sbo-site-nav">
        

  


<a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#container" class="skip">Skip to content</a><header class="topbar t-topbar"><nav role="navigation" class="js-site-nav"><ul class="topnav"><li><a href="https://learning.oreilly.com/home/" class="l0 nav-icn"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.738 14H9.254v-3.676a.617.617 0 0 0-.621-.613H7.39a.617.617 0 0 0-.62.613V14H4.284a.617.617 0 0 1-.622-.613V10.22c0-.327.132-.64.367-.87l3.547-3.493a.627.627 0 0 1 .875 0l3.54 3.499c.234.229.366.54.367.864v3.167a.617.617 0 0 1-.62.613zM7.57 2.181a.625.625 0 0 1 .882 0l5.77 5.692-.93.92-5.28-5.209-5.28 5.208-.932-.919 5.77-5.692z"></path></svg><span>Home</span></a></li><li class="search"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="t-search-nav trigger nav-icn l0" data-dropdown-selector=".searchbox"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>search icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M31.3 0C20.9 0 12.5 8.4 12.5 18.8 12.5 22.5 13.6 25.9 15.4 28.8L1.2 42.9C-0.4 44.5-0.4 47.2 1.2 48.8 2 49.6 3.1 50 4.2 50 5.2 50 6.3 49.6 7.1 48.8L21.2 34.6C24.1 36.5 27.5 37.5 31.3 37.5 41.6 37.5 50 29.1 50 18.8 50 8.4 41.6 0 31.3 0ZM31.3 31.3C24.4 31.3 18.8 25.6 18.8 18.8 18.8 11.9 24.4 6.3 31.3 6.3 38.1 6.3 43.8 11.9 43.8 18.8 43.8 25.6 38.1 31.3 31.3 31.3Z"></path></g></svg><span>Search</span></a></li><li class="usermenu dropdown"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="trigger l0 nav-icn nav-dropdown"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width="20" height="20" version="1.1" fill="#4A3C31"><desc>navigation arrow</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M0.1 12.5L9.7 3.1C9.8 3 9.9 3 10 3 10.1 3 10.2 3 10.3 3.1L19.9 12.5C20 12.5 20 12.6 20 12.8 20 12.9 20 13 19.9 13L17 15.9C16.9 16 16.8 16 16.7 16 16.5 16 16.4 16 16.4 15.9L10 9.7 3.6 15.9C3.6 16 3.5 16 3.3 16 3.2 16 3.1 16 3 15.9L0.1 13C0 12.9 0 12.8 0 12.7 0 12.7 0 12.6 0.1 12.5Z"></path></g></svg><span>Expand Nav</span></a><div class="drop-content"><ul><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M8,8 C6.34321755,8 5.00013,6.65691245 5.00013,5.00013 C5.00013,3.34334755 6.34321755,2.00026001 8,2.00026001 C9.65678245,2.00026001 10.99987,3.34334755 10.99987,5.00013 C10.99987,6.65691245 9.65678245,8 8,8 Z M2.33024571,11.3523547 L2.33774538,11.3523547 C3.7622187,9.70968996 5.82947484,8.76608166 8.00374984,8.76608166 C10.1780248,8.76608166 12.245281,9.70968996 13.6697543,11.3523547 C13.8892083,11.6177474 14.0062813,11.9530021 13.99974,12.2973138 L13.99974,13.99974 L2.00026001,13.99974 L2.00026001,12.2973138 C1.99371867,11.9530021 2.11079172,11.6177474 2.33024571,11.3523547 Z" id="path-1"></path></svg><span>Your O'Reilly</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/profile/" class="l2 nav-icn"><span>Profile</span></a></li><li><a href="https://learning.oreilly.com/history/" class="l2 nav-icn"><span>History</span></a></li><li><a href="https://learning.oreilly.com/playlists/" class="l2 nav-icn"><span>Playlists</span></a></li><li><a href="https://learning.oreilly.com/u/6d9ee17b-34b1-4bf4-bdae-19676bd84ca1/" class="l2 nav-icn"><span>Highlights</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Featured</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/featured/navigating-21st-century/" class="l2 nav-icn"><span>Navigating Change</span></a></li><li><a href="https://learning.oreilly.com/recommendations/" class="l2 nav-icn"><span>Recommended</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="20" height="20" version="1.1" fill="#4A3C31"><desc>queue icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M25 29.2C25.4 29.2 25.8 29.1 26.1 28.9L48.7 16.8C49.5 16.4 50 15.5 50 14.6 50 13.7 49.5 12.8 48.7 12.4L26.1 0.3C25.4-0.1 24.6-0.1 23.9 0.3L1.3 12.4C0.5 12.8 0 13.7 0 14.6 0 15.5 0.5 16.4 1.3 16.8L23.9 28.9C24.2 29.1 24.6 29.2 25 29.2ZM7.3 14.6L25 5.2 42.7 14.6 25 24 7.3 14.6ZM48.7 22.4L47.7 21.9 25 34.2 2.3 21.9 1.3 22.4C0.5 22.9 0 23.7 0 24.7 0 25.6 0.5 26.5 1.3 26.9L23.9 39.3C24.2 39.5 24.6 39.6 25 39.6 25.4 39.6 25.8 39.5 26.1 39.3L48.7 26.9C49.5 26.5 50 25.6 50 24.7 50 23.7 49.5 22.9 48.7 22.4ZM48.7 32.8L47.7 32.3 25 44.6 2.3 32.3 1.3 32.8C0.5 33.3 0 34.1 0 35.1 0 36 0.5 36.9 1.3 37.3L23.9 49.7C24.2 49.9 24.6 50 25 50 25.4 50 25.8 49.9 26.1 49.7L48.7 37.3C49.5 36.9 50 36 50 35.1 50 34.1 49.5 33.3 48.7 32.8Z"></path></g></svg><span>Explore</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/topics/" class="l2 nav-icn"><span>All Topics</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;sort=publication_date&amp;facet_json=true&amp;page=0" class="l2 nav-icn"><span>Early Releases</span></a></li><li><a href="https://learning.oreilly.com/playlists/discover/" class="l2 nav-icn"><span>Shared Playlists</span></a></li><li><a href="https://learning.oreilly.com/search/?query=&amp;extended_publisher_data=true&amp;highlight=true&amp;include_assessments=false&amp;include_case_studies=true&amp;include_courses=true&amp;include_orioles=true&amp;include_playlists=true&amp;include_collections=true&amp;include_notebooks=true&amp;is_academic_institution_account=false&amp;source=user&amp;formats=book&amp;formats=case%20study&amp;formats=learning%20path&amp;formats=live%20online%20training&amp;formats=notebook&amp;formats=oriole&amp;formats=video&amp;sort=popularity&amp;facet_json=true&amp;page=0&amp;collection_type=expert" class="l2 nav-icn"><span>Most Popular Titles</span></a></li><li><a href="https://learning.oreilly.com/resource-centers/" class="l2 nav-icn"><span>Resource Centers</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M12.8 3.2A1.2 1.2 0 0 1 14 4.4v8.4a1.2 1.2 0 0 1-1.2 1.2H3.2A1.2 1.2 0 0 1 2 12.8V4.4a1.2 1.2 0 0 1 1.2-1.2h1.2V2h1.2v1.2h4.8V2h1.2v1.2h1.2zm-9.6 9.6h9.6V6.2H3.2v6.6zM8 9.5a1.35 1.35 0 1 1 0-2.7 1.35 1.35 0 0 1 0 2.7zm2.7 2.148v.552H5.3v-.552c0-.321.124-.634.355-.858a3.358 3.358 0 0 1 4.69 0c.23.224.355.537.355.858z"></path></svg><span>Live Events</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/featured/strata/" class="l2 nav-icn"><span>Strata</span></a></li><li><a href="https://learning.oreilly.com/featured/oscon/" class="l2 nav-icn"><span>Open Source</span></a></li><li><a href="https://learning.oreilly.com/featured/infrastructure-ops/" class="l2 nav-icn"><span>Infra &amp; Ops</span></a></li><li><a href="https://learning.oreilly.com/featured/software-architecture/" class="l2 nav-icn"><span>Software Arch</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="l1 nav-icn "><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.6467109,4.35328907 L14.7964612,7.51003884 C15.0678463,7.78304342 15.0678463,8.22395603 14.7964612,8.49696061 L11.6467109,11.6467109 L10.6597892,10.6597892 L13.3055794,8 L10.6597892,5.34021084 L11.6467109,4.35328907 Z M4.35328907,11.6467109 L1.20353875,8.48996116 C0.932153749,8.21695658 0.932153749,7.77604397 1.20353875,7.50303939 L4.35328907,4.35328907 L5.34021084,5.34021084 L2.69442057,8 L5.34021084,10.6597892 L4.35328907,11.6467109 Z M5.84417089,11.4997226 L8.67194674,4.50027742 L10.1838269,4.50027742 L7.35605105,11.4997226 L5.84417089,11.4997226 Z" id="Mask"></path></svg><span>Practice</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/" class="l2 nav-icn"><span>Katacoda Scenarios</span></a></li><li><a href="https://learning.oreilly.com/interactive/#notebooks" class="l2 nav-icn"><span>Jupyter Notebooks</span></a></li></ul></li><li class="flyout-parent"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="l1 nav-icn "><!--?xml version="1.0" encoding="UTF-8"?--><svg width="16px" height="16px" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M10.0440191,12.1582649 C10.177209,12.3351976 10.2476998,12.552011 10.2434767,12.7742985 L10.2434767,13.9482829 L1.96869684,13.9482829 L1.96869684,12.7742985 C1.96418597,12.536863 2.04491894,12.3056731 2.19625329,12.1226596 L2.20142503,12.1226596 C3.18373453,10.9898864 4.60930376,10.339179 6.10867266,10.339179 C7.30793519,10.339179 8.45998426,10.7554703 9.37576632,11.5017585 L14.3434936,11.5017585 L14.3434936,3.65650645 L1.65650645,3.65650645 L1.65650645,11.5017585 L2.06682298,11.5017585 L1.82063306,12.1582649 L1.32825322,12.1582649 C1.14771395,12.1582649 1,12.010551 1,11.8300117 L1,3.32825322 C1,3.14771395 1.14771395,3 1.32825322,3 L14.6717468,3 C14.852286,3 15,3.14771395 15,3.32825322 L15,11.8300117 C15,12.010551 14.852286,12.1582649 14.6717468,12.1582649 L10.0440191,12.1582649 Z M12.5483683,7.16419284 C12.6159362,7.20929881 12.6563112,7.2853432 12.6558247,7.36658194 C12.6553382,7.44782068 12.6140555,7.5233761 12.5459522,7.56766966 L10.4270949,8.91581376 C10.3903366,8.94010203 10.3431312,8.9419685 10.3045699,8.9206583 C10.2660086,8.89934811 10.2424712,8.85838696 10.2434767,8.81434055 L10.2434767,5.91510593 C10.2420711,5.86982855 10.2666257,5.82771857 10.3067229,5.80664182 C10.3468202,5.78556507 10.3954292,5.7892172 10.431927,5.81604875 L12.5483683,7.16419284 Z M6.10608679,9.81089299 C4.9635781,9.81089299 4.03739181,8.8847067 4.03739181,7.74219802 C4.03739181,6.59968933 4.9635781,5.67350304 6.10608679,5.67350304 C7.24859547,5.67350304 8.17478176,6.59968933 8.17478176,7.74219802 C8.17478176,8.8847067 7.24859547,9.81089299 6.10608679,9.81089299 Z"></path></svg><span>Sandboxes</span></a><ul class="flyout"><li><a href="https://learning.oreilly.com/scenarios/kubernetes-sandbox/9781492062820/" class="l2 nav-icn"><span>Kubernetes</span></a></li><li><a href="https://learning.oreilly.com/scenarios/python-sandbox/9781492062844/" class="l2 nav-icn"><span>Python</span></a></li><li><a href="https://learning.oreilly.com/scenarios/tensorflow-sandbox/9781492062851/" class="l2 nav-icn"><span>TensorFlow</span></a></li><li><a href="https://learning.oreilly.com/scenarios/ubuntu-sandbox/9781492062837/" class="l2 nav-icn"><span>Ubuntu</span></a></li></ul></li><li><a href="https://learning.oreilly.com/live-training/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M13.4 9.8a.6.6 0 0 1 .6.6v1.2h-1.2l-.6 2.4H3.8l-.6-2.4H2v-1.2a.6.6 0 0 1 .6-.6h10.8zM8 5.6a1.8 1.8 0 1 1-.001-3.599A1.8 1.8 0 0 1 8 5.6zm3.6 2.35v.95H4.4v-.95c0-.167.066-.33.19-.443A5.08 5.08 0 0 1 8 6.2a5.08 5.08 0 0 1 3.41 1.307c.124.113.19.276.19.444z"></path></svg><span>Attend</span></a></li><li><a href="https://learning.oreilly.com/certifications/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M12.912 9.18L14 8.014l-1.088-1.18a.304.304 0 01-.075-.268L13.195 5l-1.535-.463a.313.313 0 01-.194-.194l-.462-1.537-1.565.358c-.09.03-.194 0-.269-.074L8.007 2 6.845 3.09a.303.303 0 01-.269.074l-1.565-.358-.462 1.537a.313.313 0 01-.194.194L2.82 5l.358 1.567a.26.26 0 01-.075.269L2 8.015l1.088 1.164c.075.075.09.18.075.269l-.358 1.567 1.535.463c.09.03.164.104.194.194l.462 1.537 1.565-.358c.015 0 .045-.015.075-.015.075 0 .15.03.209.074L8.007 14l1.163-1.09a.303.303 0 01.269-.074l1.565.358.462-1.537a.313.313 0 01.194-.194L13.195 11l-.358-1.567a.338.338 0 01.075-.254zm-6.046 1.37L4.41 8.26l1.16-1.244 1.767 1.649L10.4 5.6l1.202 1.202-4.242 4.243-.495-.495z"></path></svg><span>Certifications</span></a></li><li><a href="https://get.oreilly.com/email-signup.html" class="l1 nav-icn " target="&quot;_blank&quot;"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M11.564 2.263l2.172 2.174c.17.168.264.397.264.636V11a.6.6 0 0 1-.6.6h-.6V6.2h-6V2.6a.6.6 0 0 1 .6-.6h3.527c.239 0 .468.095.637.263zM2.6 14a.6.6 0 0 1-.6-.6V6.8a.6.6 0 0 1 .6-.6h1.903a1.2 1.2 0 0 1 .849.352L6.2 7.4H11a.6.6 0 0 1 .6.6v5.4a.6.6 0 0 1-.6.6H2.6zM11 5h1.8L11 3.2V5z"></path></svg><span>Newsletters</span></a></li><li><a href="https://learning.oreilly.com/u/preferences/" class="l1 nav-icn "><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 53" width="20" height="20" version="1.1" fill="#4A3C31"><desc>settings icon</desc><g stroke="none" stroke-width="1" fill-rule="evenodd"><path d="M44.6 29.6C44.7 28.6 44.8 27.5 44.8 26.5 44.8 25.5 44.7 24.4 44.6 23.4L49.6 19C50 18.8 50.1 18.3 49.9 17.9 48.9 14.7 47.1 11.7 44.9 9.1 44.6 8.8 44.2 8.7 43.8 8.8L37.4 11.1C35.8 9.8 34 8.7 32.1 8L30.9 1.4C30.8 0.9 30.4 0.6 30 0.5 26.7-0.2 23.3-0.2 20 0.5 19.6 0.6 19.2 0.9 19.1 1.4L17.9 8C16 8.7 14.1 9.8 12.6 11.1L6.2 8.8C5.8 8.7 5.4 8.8 5.1 9.1 2.9 11.7 1.1 14.7 0.1 17.9 -0.1 18.3 0 18.8 0.4 19L5.4 23.4C5.3 24.4 5.2 25.5 5.2 26.5 5.2 27.5 5.3 28.6 5.4 29.6L0.4 34C0 34.2-0.1 34.7 0.1 35.1 1.1 38.3 2.9 41.4 5.1 43.9 5.4 44.2 5.8 44.4 6.2 44.2L12.6 42C14.1 43.2 16 44.3 17.9 45L19.1 51.7C19.2 52.1 19.6 52.5 20 52.5 21.6 52.8 23.3 53 25 53 26.7 53 28.4 52.8 30 52.5 30.4 52.5 30.8 52.1 30.9 51.7L32.1 45C34 44.3 35.8 43.2 37.4 42L43.8 44.2C44.2 44.4 44.6 44.2 44.9 43.9 47.1 41.4 48.9 38.3 49.9 35.1 50.1 34.7 50 34.2 49.6 34L44.6 29.6ZM25 36.4C19.6 36.4 15.2 32 15.2 26.5 15.2 21 19.6 16.6 25 16.6 30.4 16.6 34.8 21 34.8 26.5 34.8 32 30.4 36.4 25 36.4Z"></path></g></svg><span>Settings</span></a></li><li><a href="https://learning.oreilly.com/public/support/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M7.363 6.656a2.692 2.692 0 0 1-2.681-2.703c0-1.493 1.2-2.703 2.681-2.703a2.692 2.692 0 0 1 2.682 2.703c0 1.493-1.2 2.703-2.682 2.703zm4.023 2.027c-1.852 0-3.352 1.513-3.352 3.379H2v-1.534c-.006-.31.099-.612.295-.852a6.666 6.666 0 0 1 9.09-.993zm-.543.676h1.12v.304c.003.284.16.543.408.676a.766.766 0 0 0 .77 0l.303-.176.556.966-.302.176a.772.772 0 0 0-.362.676v.08a.772.772 0 0 0 .362.677l.302.21-.556.965-.302-.175a.766.766 0 0 0-.771 0 .778.778 0 0 0-.409.675v.352h-1.106v-.372a.778.778 0 0 0-.409-.676.766.766 0 0 0-.77 0l-.303.176-.556-.912.302-.176a.772.772 0 0 0 .362-.676v-.04-.04a.772.772 0 0 0-.362-.676l-.302-.176.556-.966.289.155a.766.766 0 0 0 .77 0 .778.778 0 0 0 .41-.676V9.36zm1.562 2.703c0-.271-.108-.531-.3-.722a1.001 1.001 0 0 0-.72-.292 1.01 1.01 0 0 0-.992 1.023 1.01 1.01 0 0 0 1.01 1.004 1.01 1.01 0 0 0 1.002-1.013z"></path></svg><span>Support</span></a></li><li><a href="https://learning.oreilly.com/accounts/logout/" class="l1 nav-icn "><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M2.613 12.63A.607.607 0 0 1 2 12.03V3.602C2 3.269 2.274 3 2.613 3h5.515v1.204H3.226v7.223h4.902v1.203H2.613zM5.677 9.02V6.611h4.903V4.926a.301.301 0 0 1 .19-.274.31.31 0 0 1 .33.063l2.722 2.673a.594.594 0 0 1 0 .849L11.1 10.909a.31.31 0 0 1-.331.063.301.301 0 0 1-.19-.274V9.02H5.677z"></path></svg><span>Sign Out</span></a></li></ul></div></li></ul></nav></header>



      </div><script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","1732687426968531");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1732687426968531&amp;ev=PageView&amp;noscript=1"></noscript><script type="text/javascript" id="">(function(){window.medalliaUserIdentifier=document.documentElement.dataset.userUuid;window.medalliaUserName=document.documentElement.dataset.username})();</script>
<script type="text/javascript" id="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/embed.js.下载"></script>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("set","agent","tmgoogletagmanager","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>

<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","443792972845831");fbq("track","PageView");</script>
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=443792972845831&amp;ev=PageView&amp;noscript=1"></noscript>
<div style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.6855428423624328"><img style="width:0px; height:0px; display:none; visibility:hidden;" id="batBeacon0.6430550841884699" width="0" height="0" alt="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/0"></div>
      <div id="container" class="application" style="height: auto;">
        
          <div class="nav-container clearfix">
            


            
            
          </div>

          

  <div class="js-toc">
    
      <div class="sbo-reading-menu sbo-menu-top"><section class="sbo-toc-container toc-menu"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="sbo-toc-thumb"><span class="sbo-title ss-list"><h1><div class="visuallyhidden">Table of Contents for </div>
      
      Practical Microservices Architectural Patterns: Event-Based Java Microservices with Spring Boot and Spring Cloud
      
    </h1></span></a><div class="toc-contents"></div></section></div>

    

    <div class="interface-controls interface-controls-top">
      <ul class="interface-control-btns js-bitlist js-reader">
        <li class="js-search-in-archive search-in-archive t-search-in-archive"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" title="Search in archive" class="js-search-controls search-controls" onclick="window.Appcues.track(&#39;SearchBook_HeronBook&#39;)"><span class="icon">Search in book...</span></a><form class="search-archive-bar js-search-form"><input type="search" name="query" placeholder="Search inside this book..." autocomplete="off"></form><div class="search-archive-results"><div class="js-sitb-results-region"></div></div></li><li class="queue-control"><div class="js-content-uri" data-content-uri="/api/v1/book/9781484245019/chapter/html/477630_1_En_12_Chapter.xhtml"><div class="js-collections-dropdown collections-dropdown menu-bit-cards" onclick="window.Appcues.track(&#39;AddPlaylist_HeronBook&#39;)"><div data-reactroot="" class="menu-dropdown-wrapper js-menu-dropdown-wrapper align-right"><img class="hidden" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/ajax-transp.gif" alt="loading spinner"><div class="menu-control"><div class="control "><div class="js-playlists-menu"><button class="js-playlist-icon"><svg class="icon-add-to-playlist-sml" viewBox="0 0 16 14" version="1.1" xmlns="http://www.w3.org/2000/svg"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g fill-rule="nonzero" fill="#000000"><g transform="translate(-1.000000, 0.000000)"><rect x="5" y="0" width="12" height="2"></rect><title>Playlists</title><path d="M4.5,14 C6.43299662,14 8,12.4329966 8,10.5 C8,8.56700338 6.43299662,7 4.5,7 C2.56700338,7 1,8.56700338 1,10.5 C1,12.4329966 2.56700338,14 4.5,14 Z M2.5,10 L4,10 L4,8.5 L5,8.5 L5,10 L6.5,10 L6.5,11 L5,11 L5,12.5 L4,12.5 L4,11 L2.5,11 L2.5,10 Z"></path><circle cx="2" cy="5" r="1"></circle><circle cx="1.94117647" cy="1" r="1"></circle><rect x="5" y="4" width="12" height="2"></rect><rect x="9" y="8" width="8" height="2"></rect><rect x="9" y="12" width="8" height="2"></rect></g></g></g></svg><div class="js-playlist-addto-label">Add&nbsp;To</div></button></div></div></div></div></div></div></li><li class="js-font-control-panel font-control-activator"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" data-push-state="false" id="font-controls" title="Change font size" aria-label="Change font size" onclick="window.Appcues.track(&#39;ChangeFont_HeronBook&#39;)"><span class="icon">Toggle Font Controls</span></a></li><li class="dropdown sharing-controls"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="trigger" data-push-state="false" title="Share" aria-label="Share" onclick="window.Appcues.track(&#39;Share_HeronBook&#39;)"><i class="fa fa-share"></i></a><ul class="social-sharing dropdown-menu"><li><a class="twitter share-button t-twitter" target="_blank" aria-label="Share this section on Twitter" title="Share this section on Twitter" href="https://twitter.com/share?url=https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml&amp;text=Practical%20Microservices%20Architectural%20Patterns%3A%20Event-Based%20Java%20Microservices%20with%20Spring%20Boot%20and%20Spring%20Cloud&amp;via=OReillyMedia"><span>Twitter</span></a></li><li><a class="facebook share-button t-facebook" target="_blank" aria-label="Share this section on Facebook" title="Share this section on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml"><span>Facebook</span></a></li><li><a class="googleplus share-button t-googleplus" target="_blank" aria-label="Share this secton on Google Plus" title="Share this secton on Google Plus" href="https://plus.google.com/share?url=https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml"><span>Google Plus</span></a></li><li><a class="email share-button t-email" aria-label="Share this section via email" title="Share this section via email" href="mailto:?subject=Safari:%2012.%C2%A0Axon%20for%20CQRS%20Architecture&amp;body=https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml%0D%0Afrom%20Practical%20Microservices%20Architectural%20Patterns%3A%20Event-Based%20Java%20Microservices%20with%20Spring%20Boot%20and%20Spring%20Cloud%0D%0A"><span>Email</span></a></li></ul></li><!-- endif request.user.is_authenticated -->
      </ul>
    </div>

      
          
      

    <section role="document">
        
        




  <script defer="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/djangoMessagesP.下载"></script>


        <script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/48743.js.下载"></script>
<script>
  var userId = "6d9ee17b-34b1-4bf4-bdae-19676bd84ca1";

  var userObject = {
    firstName: "Feng",
    segment: "B2B",
    admin: "False",
    profileCreatedOn: "2019-03-11",
    academic: "false"
  };
  window.Appcues.identify(userId, userObject);
  window.Appcues.page();

  setTimeout(function () {
    window.Appcues.track('ViewingBook_HeronBook')
  }, 20000);
</script>


	  <div class="t-sbo-prev sbo-prev sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_11_Chapter.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">11.&nbsp;Events, Eventuality, and Consistency</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-top">
  
    
      
        <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_13_Chapter.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">13.&nbsp;Distributed Transactions</div>
        </a>
    
  
  </div>



<div id="sbo-rt-content" style="transform: none;"><div class="annotator-wrapper"><div class="ChapterContextInformation"><div class="ContextInformation" id="b978-1-4842-4501-9_12"><div class="ChapterCopyright">©&nbsp;Binildas Christudas&nbsp;2019</div><span class="ContextInformationAuthorEditorNames"><span class="Author"><span class="AuthorName">Binildas&nbsp;Christudas</span></span></span><span class="ContextInformationBookTitles"><span class="BookTitle" epub:type="title" lang="en">Practical Microservices Architectural Patterns</span></span><span class="ChapterDOI"><a href="https://doi.org/10.1007/978-1-4842-4501-9_12">https://doi.org/10.1007/978-1-4842-4501-9_12</a></span></div></div><!--Begin Abstract--><div class="MainTitleSection"><h1 class="ChapterTitle" lang="en">12.&nbsp;Axon for CQRS Architecture</h1></div><div class="AuthorGroup"><div class="AuthorNames"><span class="Author"><span class="AuthorName">Binildas&nbsp;Christudas</span><sup><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Aff2" class="totri-footnote">1</a>&nbsp;<span class="ContactIcon"></span></sup></span></div><div class="Affiliations"><div class="Affiliation" id="Aff2"><span class="AffiliationNumber">(1)</span><div class="AffiliationText">Trivandrum, Kerala, India</div></div><div class="ClearBoth">&nbsp;</div></div></div><!--End Abstract--><div class="Fulltext"><p class="Para" id="Par2">In Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_11_Chapter.xhtml"><span class="RefSource">11</span></a></span>, you learned about events and event-driven architecture, and you also looked into the theorems and constraints within which any EDA-based application can operate. Microservices architecture inherently bring partitions, hence concrete mechanisms to attain partition tolerance are of great importance. You will do that in this chapter with the help of Axon. <span id="ITerm1">Axon</span> is a lightweight framework that will help you develop applications following the <span id="ITerm2">CQRS</span> pattern. The Axon framework is licensed under the Apache 2 license so you can use the framework in any application for free. However, if you need professional services around Axon, they are provided by AxonIQ B.V., which is based in Amsterdam.</p><p class="Para" id="Par3">Axon is not mandatory to build CQRS-based systems, nor is a CQRS pattern mandatory to build systems using Axon. However, any new framework is an additional layer of debt in your application stack, so one of the primary reasons for you to use Axon in your application would be your urge to follow the CQRS pattern in building applications. Again, CQRS is not a mandatory prerequisite for you to architect microservices; however, CQRS provides leverage to address distributed enterprise software system concerns about scalability, so Axon and microservices go hand in hand.</p><p class="Para" id="Par4">You went into enough depth on <span id="ITerm3">Spring Boot</span> and <span id="ITerm4">Spring Cloud</span> in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_7_Chapter.xhtml" class="totri-footnote"><span class="RefSource">7</span></a></span> and Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_8_Chapter.xhtml" class="totri-footnote"><span class="RefSource">8</span></a></span>, and you will be leveraging both extensively while using Axon in this chapter. This marriage of CQRS with Spring Cloud will arm you with the combination of the most powerful tools from both worlds.</p><div class="Para" id="Par5">You will do the following in this chapter:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par6">Meet Axon, the Java CQRS framework</p></li><li><p class="Para" id="Par7">Understand the building blocks of Axon</p></li><li><p class="Para" id="Par8">Build and run an introductory CQRS example</p></li><li><p class="Para" id="Par9">Build and run a fully distributed CQRS microservices example</p></li></ul></div></div><section class="Section1 RenderAsSection1" id="Sec1"><h2 class="Heading">Introducing Axon, the CQRS Framework</h2><p class="Para" id="Par10">There are quite a few frameworks that allow you to architect CQRS-based solutions in the open source community and in the commercial world, both in Java and the .NET platforms. I picked Axon due to its free nature of the open source license and its integration options with other mainstream languages and platforms, including Java and Spring.</p><p class="Para" id="Par11">In this chapter, you will look at working examples using both Axon and Spring Boot. As I introduce the examples, I will also cover the essential concepts and APIs. You are advised to refer to the Axon documentation for detailed coverage on the usage of the framework since I will not attempt to duplicate the Axon documentation here. Instead, I will walk you through the core concepts with examples so that you are geared up to speed quickly.</p><p class="Para" id="Par12">You will be using two different versions of Axon for these examples. You will first use Axon 2.4.1. Here, you require explicit wiring of components, either through annotations or using XML configurations. Moreover, the Axon 2.4.1 example will leverage the 1.3.5.RELEASE version of Spring Boot. Later in the book, you will also look at examples in Axon 3.0.5 where you use the Spring Boot 1.5.3.RELEASE version. In Axon 3.0.5, a lot of explicit wiring can be avoided since Axon uses the Spring Application Context to locate specific implementations of building blocks and provides a default for those that are not there. Even though this will make life easier for the developer, if you are not an experienced Axon developer, you may not be able to appreciate what is happening under the hood. In Axon 2.4.1, much of this wiring is explicit and thus visible in code as annotations or in configurations as XML, so you can get a better understanding what is happening in the underlying layers. For that reason, you will use the previous (2.4.1) version<sup><a epub:type="noteref" href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fn1" id="Fn1_source" class="totri-footnote">1</a></sup> of Axon for the examples to start with. However, I will give you an easy roadmap for later Axon versions<sup><a epub:type="noteref" href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fn2" id="Fn2_source" class="totri-footnote">2</a></sup> by providing the same examples in those versions too.</p><section class="Section2 RenderAsSection2" id="Sec2"><h3 class="Heading">What Is Axon?</h3><p class="Para" id="Par15">The Axon framework helps developers apply the CQRS architectural pattern and build modular, SOA-based solutions. Traditional SOA architecture addresses some mainstream concerns in software architectures; however, Axon fills the gap that has been found in the experience while using SOA over the last two decades. Axon provides implementations of the most important building blocks, such as <span id="ITerm5">aggregates</span>, <span id="ITerm6">repositories</span>, and <span id="ITerm7">event buses</span> (the dispatching mechanism for events). Aggregates take care of grouping entities in a parent-child hierarchy and prescribe clear responsibility to aggregate roots to manage the lifecycle of the entity tree in terms of data consistency and synchronization. Event buses help you to do away with all the nitty-gritty details of creating, maintaining, and tracking correlation ids between different parts of your application. Axon guarantees the delivery of events to the right event listeners and processing them in parallel as well as in the intended sequence. Next, Axon uses Java annotation support, which means you can build aggregates and event listeners without tying your code to Axon-specific logic.</p></section><section class="Section2 RenderAsSection2" id="Sec3"><h3 class="Heading">Where Can You Use Axon?</h3><div class="Para" id="Par16">Axon is free and open source, and has the tag line of <em class="EmphasisTypeItalic ">The Jargon CQRS</em> (which many of your peers are still searching the Internet to understand what it means), which is quite enough to maintain the attention of executive management for a long time, so why not use it in every new application you build? Unfortunately, CQRS is not simple and straightforward compared to traditional one-to-one and synchronous architecture styles. Conceiving future complexities to an extent at the start of architecture design is required; further your design has to accommodate and evolve more combinations of scenarios, states, and flows compared to traditional SOA or for that matter even compared to microservices without CQRS. However, if you understand this and if you attempt it, the effort will be paid back in more than one way. Here are some scenarios where CQRS makes more sense:<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par17"><span id="ITerm8">
                      <strong class="EmphasisTypeBold ">Extensible architectures</strong>
                      
                      
                    </span>: Typical applications are built with a span of life in mind, say 10, 20, or even 50 years (if you still program in assembly or mainframe); however, during this span many of these applications are likely to be extended with more functionality. It’s the same story for applications built today, getting deployed to clouds and containers. However, business continuity is paramount, and extensions both in terms of functionality and quality of system (QoS) have to be effected with zero disruption to running systems. Can you do this? Is this expectation realistic or still a myth? Well, the answer depends not on the technologies and frameworks available alone. You need to combine them with your architectural thoughts too, put aside all other advancements in DevOps, etc.</p></li><li><p class="Para" id="Par18"><strong class="EmphasisTypeBold ">High read-to-write ratio</strong>: Recollect the discussion about <span id="ITerm9">the look-to-book</span> ratio in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_5_Chapter.xhtml" class="totri-footnote"><span class="RefSource">5</span></a></span>. A system will have to accommodate hundreds or <span id="ITerm10">thousands</span> of read transactions before it gets converted into a single write transaction. Building the operational QoS into your read transactions similar to write transactions would be disastrous in today’s enterprise software paradigm, especially in the cloud native scenarios, where every CPU cycle or every bit stored or transported adds to your cost. Your read transactions are your LEAD transactions, and your write transactions are your LAG transactions. The first one converts “intent” to “decision” of purchase whereas the second one converts your “inventory” to “realized margin.” Both are important; however, the criticality is different. An unsuccessful write transaction due to functional or system issues is priceless, whereas an unsuccessful read transaction will have less of an impact since it can be either retried or ignored; its value lost is considerably low compared to that of an unsuccessful write transaction. Data sources for queries are to be tuned differently than those used for command execution, and they should be optimized for fast querying with relaxed locks in resources; however, for write transactions, your data sources should ensure strict ACID compliancy so that once a traveler successfully purchases the last seat on your airplane, you will have all the means to respect that purchase so that you don’t need to later send a regret e-mail to that traveler telling him that the seat is not available for so-and-so reason and hence he will be provided with a refund!</p></li><li><p class="Para" id="Par19"><strong class="EmphasisTypeBold ">Single source of truth, many views</strong>: “Resources” were first defined on the World Wide Web as documents or files identified by their URLs. However, today they have a much more generic and abstract definition that encompasses every thing or every entity that can be identified, named, addressed, or handled, in any way whatsoever, on the Web. In a RESTful web service, requests made to a resource’s URI will elicit a response that may be in CSV, XML, HTML, JSON, or some other format. The same data in your application may be represented in many ways, some optimized for quick searching, others in a cached state for maximum responsiveness, and others in the form of canned reports like an Excel or PDF file. This is the application-level reality of the <span id="ITerm11">single source of truth</span> of resource existing in many views. CQRS addresses this requirement explicitly and also helps you keep the different views in sync with the single source of truth whenever a change occurs in the form of raising events.</p></li><li><p class="Para" id="Par20"><strong class="EmphasisTypeBold ">Application with varied interactions</strong>: Some applications will have a user base at varied levels of interaction with the system. For example, an e-commerce application has end users or customers doing retail purchases as one set of the user base, and that number will be huge; also, these customers expect a split-second response time. The next set is the back office storekeepers who manage the inventories, whose numbers are limited and who suffer if the software is slow or sluggish at times. A third set is the B2B interfaces connecting with the supply chain, whose number is even smaller, in the form of a few known IP addresses, and who also suffer if the interfaces are down for a few minutes because then they have to retry at a later time. Depending upon the type of interacting parties and the overall value and criticality of the transactions on behalf of these parties, software services within the same application may have to exhibit different levels of access, security, performance, and so on. Microservices architectures will help you here, and adopting CQRS will provide you the extra leverage to address these heterogeneous kinds of interactions.</p></li><li><p class="Para" id="Par21"><strong class="EmphasisTypeBold ">Applications with autonomous interfaces</strong>: The IoT and the WoT are current software paradigms that pose a new set of challenges to software architects. The strict definition of an application’s API using commands and events makes it easier to integrate with such interfaces of things and devices. Any interface can send commands or listen to events generated by the host interface.</p></li></ul></div></div><p class="Para" id="Par22">The above list provides only a general list of problem characteristics where CQRS will value add; it’s in no way exhaustive.</p></section><section class="Section2 RenderAsSection2" id="Sec4"><h3 class="Heading">What You Need to Run Axon</h3><p class="Para" id="Par23">The Axon framework has been built and tested against Java 6, making that more or less the only requirement. You can use Gradle or Maven for the build and also use any IDE of your choice. Since Axon doesn’t create any connections or threads by itself, it is safe to run on an application server. Axon abstracts all asynchronous behavior by using <span id="ITerm12">executors</span>, which decouple task submission from the mechanics of how each task will be run. So you can even easily pass a container-managed thread pool, for example. If you don’t use an application server (e.g. Tomcat, Jetty, or a stand-alone app), you can use the <span class="EmphasisFontCategoryNonProportional ">Executors</span> class or the Spring Framework to create and configure <span id="ITerm13">thread pools</span>.</p><p class="Para" id="Par24">You will now look at some concrete examples and see Axon code in action.</p></section></section><section class="Section1 RenderAsSection1" id="Sec5"><h2 class="Heading">Command and Event Handling in the&nbsp;Same JVM</h2><p class="Para" id="Par25">Simple things first, so let’s keep the first example in Axon simple. However, I can’t make it simpler. To introduce Axon, you must first understand a simple scenario in the Axon way and then look at the details of what each of the steps mean in Axon.</p><section class="Section2 RenderAsSection2" id="Sec6"><h3 class="Heading">The Sample Scenario</h3><div class="Para" id="Par26">The first Axon example is a single microservice from an e-commerce application. There are two entities in the domain, order and <span id="ITerm14">product</span>. Users can buy a product, which will create a new order. When a new order is created, the product stock will get depreciated. Just that. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig1">12-1</a></span> depicts the architecture with the complete flow labelled.<figure class="Figure" id="Fig1"><div class="MediaObject" id="MO1"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig1_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1_En_12.jpg" style="height:44.55em" width="1639" height="1782" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig1_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-1.</span><p class="SimplePara">Axon command and event handling in the same JVM</p></div></figcaption></figure></div><p class="Para" id="Par27">The “A <span id="ITerm15">Meta Model</span> for Event-Based CQRS Design” section in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_5_Chapter.xhtml" class="totri-footnote"><span class="RefSource">5</span></a></span> shows a meta model for a CQRS-based architecture. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig1">12-1</a></span> is a concrete incarnation of that abstract meta model represented in Figure&nbsp;<span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_5_Chapter.xhtml#Fig5"><span class="RefSource">5-5</span></a></span>&nbsp;in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_5_Chapter.xhtml" class="totri-footnote"><span class="RefSource">5</span></a></span>.</p><div class="Para" id="Par28">Let’s now explore the end-to-end flow, which is labelled in the <span id="ITerm16">diagram</span> as follows:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par29">When you click the “Order One Now!” button in the browser, a REST/JSON request hits the order controller.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par30">The order controller interprets the request as a write request and creates a new order command and sends it to the command gateway, which in turn dispatches the command to the command bus.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par31">The command bus receives the commands and routes them to the order command handler.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par32">The order command handler retrieves the corresponding product and depreciates the stock.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par33">Upon depreciating the stock of the product, the change is effected in the product repository by sending an update to the product entity, which will get persisted in the Write DB.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par34">This repository change fires a stock updated event to the event bus, which in turn dispatches events to all interested event listeners.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par35">The product event handler has subscribed to the stock updated event, so it gets notified with the details of the stock update.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par36">Based on the details mentioned in the stock updated event, the product event handler makes changes to the read model of the product.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par37">In step 4, you saw that the order command handler depreciated the product stock. It also created a new order, based on the details mentioned in the new order command it received.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par38">When a new order is created, it is effected in the order repository by sending an insert of a new order entity, which will subsequently get persisted in the Write DB.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par39">This repository insert fires an order created event to the event bus, which in turn dispatches events to all interested event listeners.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par40">The order event handler has subscribed to the order created event, so it gets notified with the details of the new order created.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par41">Based on the details mentioned in the order created event, the order event handler makes changes to the read model of the order.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par42">The <span id="ITerm17">browser</span> can refresh itself to keep the view updated from querying the read model of the entities.</p></div><div class="ClearBoth">&nbsp;</div></li></ol></div></div></section><section class="Section2 RenderAsSection2" id="Sec7"><h3 class="Heading">Code the Sample Scenario</h3><div class="Para" id="Par43">All the code <span id="ITerm18">examples</span> for this section are in folder <span class="EmphasisFontCategoryNonProportional ">ch12\ch12-01</span>. Visit <span class="EmphasisFontCategoryNonProportional ">pom.xml</span> to see the explicit mention of the Axon dependency. See Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC1">12-1</a></span>.<div class="ProgramCode" id="PC1"><div class="LineGroup"><div class="FixedLine">&lt;dependency&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.axonframework&lt;/groupId&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;axon-core&lt;/artifactId&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;2.4.1&lt;/version&gt;</div><div class="FixedLine">&lt;/dependency&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-1</span><p class="SimplePara">Axon Maven Dependency (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\pom.xml)</p></div></div></div></div><div class="Para" id="Par44">This first Axon example is a first class Spring Boot citizen, hence there is nothing special in the <span class="EmphasisFontCategoryNonProportional ">main</span> application class; still you can look at the code in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC2">12-2</a></span>.<div class="ProgramCode" id="PC2"><div class="LineGroup"><div class="FixedLine">@SpringBootApplication</div><div class="FixedLine">public class EcomApplication {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public static void main(String[] args) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SpringApplication.run(EcomApplication.class, args);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-2</span><p class="SimplePara">Spring Boot Application Class (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\EcomApplication.java)</p></div></div></div></div><div class="Para" id="Par45">Next is the most <span id="ITerm19">important</span> class of this example where you do the setup of all Axon components; see Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC3">12-3</a></span>.<div class="ProgramCode" id="PC3"><div class="LineGroup"><div class="FixedLine">@Configuration</div><div class="FixedLine">public class EcomAppConfiguration {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@PersistenceContext</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private EntityManager entityManager;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public SimpleCommandBus commandBus() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new SimpleCommandBus();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public SimpleEventBus eventBus() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new SimpleEventBus();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;AnnotationCommandHandlerBeanPostProcessor</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotationCommandHandlerBeanPostProcessor() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnnotationCommandHandlerBeanPostProcessor handler =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new AnnotationCommandHandlerBeanPostProcessor();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handler.setCommandBus(commandBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return handler;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;AnnotationEventListenerBeanPostProcessor</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotationEventListenerBeanPostProcessor() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnnotationEventListenerBeanPostProcessor listener =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new AnnotationEventListenerBeanPostProcessor();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listener.setEventBus(eventBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return listener;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public DefaultCommandGateway commandGateway() {<span id="ITerm20">
                      
                      
                      
                    </span></div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new DefaultCommandGateway(commandBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("productRepository")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public GenericJpaRepository&lt;Product&gt; productJpaRepository() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleEntityManagerProvider entityManagerProvider =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new SimpleEntityManagerProvider(entityManager);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GenericJpaRepository&lt;Product&gt; genericJpaRepository =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new GenericJpaRepository(entityManagerProvider, Product.class);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;genericJpaRepository.setEventBus(eventBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return genericJpaRepository;</div><div class="FixedLine">}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("orderRepository")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public GenericJpaRepository&lt;Order&gt; orderJpaRepository() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleEntityManagerProvider entityManagerProvider =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new SimpleEntityManagerProvider(entityManager);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;GenericJpaRepository&lt;Order&gt; genericJpaRepository =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new GenericJpaRepository(entityManagerProvider, Order.class);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;genericJpaRepository.setEventBus(eventBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return genericJpaRepository;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-3</span><p class="SimplePara">Spring Axon Configurations (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\EcomAppConfiguration.java)</p></div></div></div></div><p class="Para" id="Par46">I will explain the Axon-specific components now. The <span id="ITerm21">SimpleCommandBus</span><span id="ITerm22">
                
                
                
              </span> does straightforward processing of commands in the same thread that dispatches them. After a command is processed, the modified aggregate(s) are saved and any generated events are published in that same thread.</p><p class="Para" id="Par47">An <span id="ITerm23">aggregate</span> is an entity or group of entities that are always kept in a consistent state. An <span id="ITerm24">aggregate root</span><span id="ITerm25">
                
                
                
              </span> is the object on top of the aggregate tree that is responsible for maintaining this consistent state. For example, an order aggregate could contain entities like line items and a delivery address. In order to keep the full aggregate in a consistent state, changing the address of this order should be done via the order aggregate, not by directly accessing the address entity.</p><p class="Para" id="Par48">The SimpleCommandBus maintains the notion of a unit of work (UoW) for each command published. Since all command processing is done in the same thread, this implementation is limited to a single JVM’s boundaries.</p><p class="Para" id="Par49">A <span id="ITerm26">unit of work</span> is a set of modifications to be made to aggregates. Execution of a command typically happens within the scope of a unit of work. When a command handler finishes execution, the UoW is committed and all actions are finalized. This means that any repositories are notified of state changes in their aggregates and events scheduled for publication are sent to the <span id="ITerm27">event bus</span><span id="ITerm28">
                
                
                
              </span>. This is a convenient grouping that will help to prevent individual events from being published before a number of aggregates have been processed. In the back, it allows repositories to manage resources, such as locks, over an entire transaction. <span id="ITerm29">Locks</span>, for example, will only be released when the unit of work is either committed or rolled back.</p><p class="Para" id="Par50">A unit of work is not a replacement for traditional <span id="ITerm30">ACID</span>-style transactions. It is merely a buffer where changes are grouped and staged. When a unit of work is committed, all staged changes are only committed; however, this commit is not atomic. That means if a commit fails, a few changes might have already been persisted, while others not. So Axon best practices dictate that a command should always containing one action. If you have more actions in your unit of work, then you should consider attaching a transaction to the unit of work’s commit, for which you can refer to the Axon documentation.</p><p class="Para" id="Par51">The <span id="ITerm31">SimpleEventBus</span>, as the name suggests, is a very basic implementation of the EventBus interface and is a mechanism used to dispatch events to the subscribed event listeners. It is good when the event dispatching is done synchronously and locally (i.e. in a single JVM). It manages subscribed EventListeners and forwards all incoming events to all subscribed listeners. EventListeners must be explicitly registered with the event bus in order for them to receive events. The registration process is thread safe and listeners may register and unregister for events at any time. If an EventListener throws an exception, the event dispatching stops and the exception is propagated to the component publishing the event.</p><div class="Para" id="Par52">AnnotationCommandHandlerBeanPostProcessor will automatically register classes containing command handler methods (i.e. methods annotated with the <span class="EmphasisFontCategoryNonProportional ">@CommandHandler</span> annotation) with a command bus.<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par53">This bean post processor will scan the application context for all beans with an <span class="EmphasisFontCategoryNonProportional ">@CommandHandler</span> annotated method.</p></li><li><p class="Para" id="Par54">All such command handlers will be automatically recognized and subscribed to the command bus.</p></li></ul></div></div><div class="Para" id="Par55">AnnotationEventListenerBeanPostProcessor will automatically register classes containing event handler methods (i.e. methods annotated with the <span class="EmphasisFontCategoryNonProportional ">@EventHandler</span> annotation) in your application context and automatically connect them to the event bus.<div class="UnorderedList"><ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par56">This bean post processor will scan the application context for all the beans with an <span class="EmphasisFontCategoryNonProportional ">@EventHandler</span> annotated method.</p></li><li><p class="Para" id="Par57">All such event listener will be automatically recognized and subscribed to the event bus.</p></li></ul></div></div><p class="Para" id="Par58">The command gateway is a convenient interface for the command dispatching mechanism. Usage of a gateway to dispatch commands is optional; however, it is generally the easiest option to do so. <span id="ITerm32">CommandGateway </span>is the interface and <span id="ITerm33">DefaultCommandGateway </span>is the default implementation provided by Axon. The gateway provides a number of methods that allow you to send a command and wait for a result either synchronously, with a timeout, or asynchronously.</p><div class="Para" id="Par59">The GenericJpaRepository is a repository implementation that can store aggregates that are JPA compatible. It is configured with an EntityManager that manages the actual persistence and classes specifying the actual type of aggregate stored in the repository, <span class="EmphasisFontCategoryNonProportional ">Product</span> and <span class="EmphasisFontCategoryNonProportional ">Order</span> in your case. All the JPA-annotated aggregates must implement the AggregateRoot and have the proper JPA annotations. The repository may be configured with a locking scheme. The repository will always force <span id="ITerm34">optimistic locking</span> in the backing persistent store. An optional lock can be configured for the repository, in which case it will be in addition to this optimistic lock. Locks on one repository instance will not be shared with other repository instances. When this repository is requested to persist changes to an aggregate, it will also flush the EntityManager, during which it will enforce checking of database constraints and optimistic locks. Let’s look at your AggregateRoot <span id="ITerm35">entities</span> now; see Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC4">12-4</a></span>.<div class="ProgramCode" id="PC4"><div class="LineGroup"><div class="FixedLine">import org.axonframework.domain.AbstractAggregateRoot;</div></div><div class="LineGroup"><div class="FixedLine">@Entity</div><div class="FixedLine">@Table(name="ECOM_ORDER")</div><div class="FixedLine">@Data</div><div class="FixedLine">@EqualsAndHashCode(exclude = { "id" })</div><div class="FixedLine">public class Order extends AbstractAggregateRoot&lt;Integer&gt; {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Id</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Integer id;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Column(name="PRICE")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Double price;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Column(name="NUMBER")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Integer number;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Column(name="ORDER_STATUS")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Enumerated(EnumType.STRING)</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private OrderStatusEnum orderStatus; ;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@ManyToOne(fetch=FetchType.LAZY)</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@JoinColumn(name="PRODUCT_ID")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Product product;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Override</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public Integer getIdentifier() {</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return id;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public Order(Integer id, Double price, Integer number,</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OrderStatusEnum orderStatus, Product product) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.id = id;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.price = price;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.number = number;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.orderStatus = orderStatus;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.product = product;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registerEvent(new OrderCreatedEvent(id, price, number,</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product.getDescription(), orderStatus.toString()));</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-4</span><p class="SimplePara">Order Aggregate Entity (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\order\model\Order.java)</p></div></div></div></div><div class="Para" id="Par60"><span class="EmphasisFontCategoryNonProportional ">Order</span> extends <span id="ITerm36">AbstractAggregateRoot</span>, a very basic implementation of the AggregateRoot <span id="ITerm37">interface</span>. It provides the mechanism to keep track of all uncommitted events and also maintains a version number based on the number of events generated, which can be used for validation during committing. Further, the <span class="EmphasisFontCategoryNonProportional ">Order</span> entity also registers events to be published when the aggregate is saved using the <span class="EmphasisFontCategoryNonProportional ">registerEvent</span> method. Next, you will look at the <span class="EmphasisFontCategoryNonProportional ">Product</span> aggregate in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC5">12-5</a></span>.<div class="ProgramCode" id="PC5"><div class="LineGroup"><div class="FixedLine">@Entity</div><div class="FixedLine">@Table(name="ECOM_PRODUCT")</div><div class="FixedLine">@Data</div><div class="FixedLine">@EqualsAndHashCode(exclude = { "id" })</div><div class="FixedLine">public class Product extends AbstractAggregateRoot&lt;Integer&gt; {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Id</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Integer id;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Column(name="PRICE")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Double price;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Column(name="STOCK")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Integer stock;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Column(name="DESCRIPTION")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private String description;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Override</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public Integer getIdentifier() {</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return id;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public void depreciateStock(int count) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(this.stock &gt;= count){</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.stock = this.stock - count;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;registerEvent(new StockUpdatedEvent(id, stock));</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw new RuntimeException("Out of stock");</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-5</span><p class="SimplePara">Product Aggregate Entity (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\product\model\Product.java)</p></div></div></div></div><p class="Para" id="Par61">The <span class="EmphasisFontCategoryNonProportional ">Product</span> aggregate<span id="ITerm38">
                
                
                
              </span> is similar in structure and functionality to that of the <span class="EmphasisFontCategoryNonProportional ">Order</span> aggregate, hence the explanation won’t be repeated here.</p><div class="Para" id="Par62">Next, you will look at commands. They are straight DTO-like classes, as shown in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC6">12-6</a></span>.<div class="ProgramCode" id="PC6"><div class="LineGroup"><div class="FixedLine">import lombok.Data;</div></div><div class="LineGroup"><div class="FixedLine">@Data</div><div class="FixedLine">public class NewOrderCommand {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Double price;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Integer number;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Integer productId;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-6</span><p class="SimplePara">New Order Command (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\order\api\command\NewOrderCommand.java)</p></div></div></div></div><p class="Para" id="Par63">It’s good practice for a <span id="ITerm39">command</span> to express its intent by its name. So you can use the Java class name to figure out what needs to be done, and the fields of the command object should provide the information required to act based on the command.</p><div class="Para" id="Par64">Now you will see the creation of the above command. When you click the “Order One Now!” button in the browser, a REST/JSON request hits the order controller, as shown in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC7">12-7</a></span>.<div class="ProgramCode" id="PC7"><div class="LineGroup"><div class="FixedLine">@RestController</div><div class="FixedLine">public class OrderController {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private DataSource dataSource;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private CommandGateway commandGateway;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@RequestMapping(value = "/orders", method = RequestMethod.POST)</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Transactional</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public ResponseEntity&lt;Void&gt; addNewOrder(@RequestBody OrderDTO orderDTO) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commandGateway.sendAndWait(new NewOrderCommand(orderDTO.getPrice(),</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orderDTO.getNumber(), orderDTO.getProductId()));</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new ResponseEntity&lt;&gt;( HttpStatus.OK);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-7</span><p class="SimplePara">Order REST Controller (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\web\controller\OrderController.java)</p></div></div></div></div><p class="Para" id="Par65">The <span class="EmphasisFontCategoryNonProportional ">Controller</span> method will create a new command and send it to the command bus and wait for it to execute. The result of the execution is returned when available. This <span class="EmphasisFontCategoryNonProportional ">sendAndWait m</span>ethod will block indefinitely, until a result is available or until the current thread is interrupted. If the thread is interrupted, this method returns null. If an exception occurs during processing, it is wrapped in a CommandExecutionException.</p><div class="Para" id="Par66">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC8">12-8</a></span> shows the <span id="ITerm40">CommandHandler</span>.<div class="ProgramCode" id="PC8"><div class="LineGroup"><div class="FixedLine">@Component</div><div class="FixedLine">public class OrderCommandHandler {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("orderRepository")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Repository&lt;Order&gt; orderRepository;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("productRepository")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private Repository&lt;Product&gt; productRepository;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@CommandHandler</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public void handle(NewOrderCommand newOrderCommand){</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Product product =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;productRepository.load(newOrderCommand.getProductId());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;product.depreciateStock(newOrderCommand.getNumber());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Order order = new Order(new Random().nextInt(),</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newOrderCommand.getPrice(),</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newOrderCommand.getNumber(), OrderStatusEnum.NEW, product);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;orderRepository.add(order);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-8</span><p class="SimplePara">Axon Order Command Handler (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\ src\main\java\com\acme\ecom\order\commandhandler\OrderCommandHandler.java)</p></div></div></div></div><p class="Para" id="Par67">The CommandHandler marker annotation will mark the handle method on the OrderCommandHandler as being a CommandHandler. The annotated <span id="ITerm41">method’s</span> first parameter is the command handled by that method. Optionally, the command handler may specify a second parameter of type UnitOfWork. The active unit of work will be passed if that parameter is supplied. A type of command can be handled by only one type of command handler. So an order command handler instance will handle a new order command, and when such a command arrives, it will retrieve the corresponding domain object, <span class="EmphasisFontCategoryNonProportional ">Product</span> (aggregates) in your case, from a repository, and execute methods on it to change the state (depreciate the stock and also create a new order in your case). These aggregates typically contain the actual business logic and are therefore responsible for guarding their own invariants. The state changes of aggregates result in the generation of domain events. In the above code, the product stock depreciation and the creation of the new order generate events. Both the domain events and the aggregates form the domain model.</p><div class="Para" id="Par68">You will now look at the code for the events generated. Events are simple data-encapsulated POJO classes. See Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC9">12-9</a></span> and Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC10">12-10</a></span>.<div class="ProgramCode" id="PC9"><div class="LineGroup"><div class="FixedLine">public class OrderCreatedEvent {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Integer id;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Double price;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Integer number;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final String productDescription;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final String orderStatus;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-9</span><p class="SimplePara">Order Created Event (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\ src\main\java\com\acme\ecom\order\api\event\OrderCreatedEvent.java)</p></div></div></div><div class="ProgramCode" id="PC10"><div class="LineGroup"><div class="FixedLine">public class StockUpdatedEvent {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Integer id;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private final Integer stock;</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-10</span><p class="SimplePara">Stock Updated Event (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\ src\main\java\com\acme\ecom\product\api\event\StockUpdatedEvent.java)</p></div></div></div></div><div class="Para" id="Par69">Now look at the event handlers capable of handling these events. If you recollect, for command handling, a type of command can be handled by only one type of command handler. However, for event handling, a type of event may be handled by zero or more types of event handlers. This is synonymous to the publish-subscribe pattern using a message topic where a message may be consumed by more than one subscriber. More on this later; let’s now look at the code for the event handlers in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC11">12-11</a></span>.<div class="ProgramCode" id="PC11"><div class="LineGroup"><div class="FixedLine">@Component</div><div class="FixedLine">public class OrderEventHandler {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;DataSource dataSource;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@EventHandler</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public void handleOrderCreatedEvent(OrderCreatedEvent event) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jdbcTemplate.update("INSERT INTO ecom_order_view VALUES(?,?,?,?,?)",</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Object[]{event.getId(),</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event.getPrice(), event.getNumber(), event.getProductDescription(),</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event.getOrderStatus()});</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-11</span><p class="SimplePara"><span id="ITerm42">Event Handler</span> for Order (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\ src\main\java\com\acme\ecom\order\eventhandler\OrderEventHandler.java)</p></div></div></div></div><div class="Para" id="Par70">The order <span id="ITerm43">event handler</span> receives the order created event after a new order has been created. Hence the only task left is to update the Order Read DB, which is done by the above code. The other event handler left is product event handler, shown in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC12">12-12</a></span>.<div class="ProgramCode" id="PC12"><div class="LineGroup"><div class="FixedLine">@Component</div><div class="FixedLine">public class ProductEventHandler {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;DataSource dataSource;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@EventHandler</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public void handleProductStockUpdatedEvent(StockUpdatedEvent event) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jdbcTemplate.update("UPDATE ecom_product_view SET stock=? WHERE ID=?",</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Object[]{event.getStock(), event.getId()});</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-12</span><p class="SimplePara">Event Handler for Product (ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\java\com\acme\ecom\product\eventhandler\ProductEventHandler.java)</p></div></div></div></div><p class="Para" id="Par71">The product <span id="ITerm44">event handler</span> will update the change in stock level of the product to the Product Read DB. In this way, every new order creation changes the Order and Product Write DBs, and all these changes are eventually propagated to the Read DB too.</p></section><section class="Section2 RenderAsSection2" id="Sec8"><h3 class="Heading">Build and Test the Example Scenario</h3><div class="Para" id="Par72">The complete code required to demonstrate this simple Axon example is in folder <span class="EmphasisFontCategoryNonProportional ">ch12\ch12-01</span>. First, update the configuration files to suit to your environment:<div class="ProgramCode" id="PC13"><div class="LineGroup"><div class="FixedLine">ch12\ch12-01\Ax2-Commands-Events-Same-JVM\src\main\resources\application.properties</div><div class="FixedLine">spring.datasource.url=jdbc:mysql://localhost/ecom01</div><div class="FixedLine">spring.datasource.username=root</div><div class="FixedLine">spring.datasource.password=rootpassword</div></div></div></div><div class="Para" id="Par73">Make sure <span id="ITerm45">MySQL</span> is up and running. You may want to refer to Appendix H to get started with MySQL.<div class="ProgramCode" id="PC14"><div class="LineGroup"><div class="FixedLine">First Bring Up MySQL Server.</div><div class="FixedLine">D:\Applns\MySQL\mysql-8.0.14-winx64\bin&gt;mysqld --console</div></div><div class="LineGroup"><div class="FixedLine">Now Open MySQL prompt</div><div class="FixedLine">D:\Applns\MySQL\mysql-8.0.14-winx64\bin&gt;mysql -u root –p</div></div><div class="LineGroup"><div class="FixedLine">mysql&gt; use ecom01;</div><div class="FixedLine">Database changed</div><div class="FixedLine">mysql&gt;</div></div></div></div><div class="Para" id="Par74">To start with clean tables, delete any tables with the names you want for your examples:<div class="ProgramCode" id="PC15"><div class="LineGroup"><div class="FixedLine">mysql&gt; drop table ecom_order;</div><div class="FixedLine">mysql&gt; drop table ecom_product;</div><div class="FixedLine">mysql&gt; drop table ecom_order_view;</div><div class="FixedLine">mysql&gt; drop table ecom_product_view;</div></div></div></div><div class="Para" id="Par75">Now, the <span class="EmphasisFontCategoryNonProportional ">ecom_order</span> and <span class="EmphasisFontCategoryNonProportional ">ecom_product</span> tables will be created when the microservice starts up. However, you need to explicitly create the Read DB tables:<div class="ProgramCode" id="PC16"><div class="LineGroup"><div class="FixedLine">mysql&gt; create table ecom_product_view(id INT , price DOUBLE, stock INT ,description VARCHAR(255));</div><div class="FixedLine">mysql&gt; create table ecom_order_view(id INT , price DOUBLE, number INT ,description VARCHAR(225),status VARCHAR(50));</div></div></div></div><div class="Para" id="Par76">You will now build and <span id="ITerm46">package</span> the executables for the Axon microservice and bring up the server. Since you used the <span class="EmphasisFontCategoryNonProportional ">mysql-8.0.14-winx64.zip</span> archive while installing the MySQL server (see Appendix H), you need to use version 8.0.14 of the <span class="EmphasisFontCategoryNonProportional ">mysql-connector-java</span> Maven artifact in the Maven build script <span class="EmphasisFontCategoryNonProportional ">pom.xml</span>. There is a utility script provided in folder <span class="EmphasisFontCategoryNonProportional ">ch12\ch12-01\Ax2-Commands-Events-Same-JVM\make.bat</span>:<div class="ProgramCode" id="PC17"><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-01\Ax2-Commands-Events-Same-JVM</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-01\Ax2-Commands-Events-Same-JVM&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-01\Ax2-Commands-Events-Same-JVM&gt;mvn clean install</div></div></div></div><div class="Para" id="Par77">You can now run the Axon Spring Boot application in more than one way. The straightforward way is to execute the JAR file via the following commands:<div class="ProgramCode" id="PC18"><div class="LineGroup"><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-01\Ax2-Commands-Events-Same-JVM&gt;run</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-01\Ax2-Commands-Events-Same-JVM&gt;mvn spring-boot:run</div></div></div></div><div class="Para" id="Par78">This will bring up the Axon Spring Boot Server in port 8080. The <span class="EmphasisFontCategoryNonProportional ">ecom_order</span> and <span class="EmphasisFontCategoryNonProportional ">ecom_product</span> tables would have been created by now. You need to prepopulate the <span class="EmphasisFontCategoryNonProportional ">ecom_product</span> and <span class="EmphasisFontCategoryNonProportional ">ecom_product_view</span> tables with some initial data:<div class="ProgramCode" id="PC19"><div class="LineGroup"><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(1,'Shirts',100,5,0);</div><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(2,'Pants',100,5,0);</div><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(3,'T-Shirt',100,5,0);</div><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(4,'Shoes',100,5,0);</div></div><div class="LineGroup"><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(1,'Shirts',100,5);</div><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(2,'Pants',100,5);</div><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(3,'T-Shirt',100,5);</div><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(4,'Shoes',100,5);</div></div></div></div><div class="Para" id="Par79">You can use a <span id="ITerm47">browser</span> (preferably Chrome) and point to <span class="EmphasisFontCategoryNonProportional ">http://localhost:8080/</span>. You can now test the example by clicking any one of the buttons in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig2">12-2</a></span>.<figure class="Figure" id="Fig2"><div class="MediaObject" id="MO2"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig2_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1(1).jpg" style="height:33.18em" width="1400" height="1327" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig2_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-2.</span><p class="SimplePara">Testing the Axon command and event handling in the same JVM</p></div></figcaption></figure></div><div class="Para" id="Par80">When you click, a new <span id="ITerm48">order</span> is created in the Order Write DB. Eventually, the Order Read DB will be updated with this new order. Also, the corresponding product stock will be reduced by one in the Product Write DB. This change will also be eventually updated in the Product Read DB. The change is reflected in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig3">12-3</a></span>.<figure class="Figure" id="Fig3"><div class="MediaObject" id="MO3"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig3_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1(2).jpg" style="height:31.92em" width="1400" height="1277" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig3_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-3.</span><p class="SimplePara">Product view <span id="ITerm49">synched</span> with product write data</p></div></figcaption></figure></div></section></section><section class="Section1 RenderAsSection1" id="Sec9"><h2 class="Heading">Distributed Command and Event Handling</h2><p class="Para" id="Par81">Enterprise-grade applications distribute processing into multiple compute nodes and multiple processes to leverage the full power of multicore processors as well as to attain maximum parallelism so as to improve overall performance. The microservices architecture is no exception, and in this example you are going to completely distribute the different Axon components across JVMs. Since the example is distributed across processes, you can practically distribute them across nodes too; however, you will execute the examples with each main Axon components in a single node (my personal laptop, in my case) for simplicity.</p><section class="Section2 RenderAsSection2" id="Sec10"><h3 class="Heading">The Example Scenario</h3><div class="Para" id="Par82">You are using the <span id="ITerm50">same scenario</span> as in the previous section. While the previous example was implemented as a single microservice, you will split the same functionality into four different microservices in this example and you will additionally introduce another microservice too. This new, fifth microservice is the Event Handler Audit microservice. The Event Handler Audit microservice has an event handler, AuditEventHandler, which too is subscribed to the order created event. So, you now have two microservices (the Event Handler Audit microservice and the Event Handle Core microservice) with two event handler types, both interested in the same order created event! Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig4">12-4</a></span> shows the design.<figure class="Figure" id="Fig4"><div class="MediaObject" id="MO4"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig4_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1(3).jpg" style="height:45.02em" width="1622" height="1801" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig4_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-4.</span><p class="SimplePara">The <span id="ITerm51">design</span> of the distributed command and event handling in Axon</p></div></figcaption></figure></div><p class="Para" id="Par83">The “Command Query Segregation Using Events” section in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_5_Chapter.xhtml" class="totri-footnote"><span class="RefSource">5</span></a></span> represented the meta model for an event-based CQRS architecture. Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig4">12-4</a></span> is a concrete incarnation of that abstract meta model represented in Figure&nbsp;<span class="ExternalRef"><a href="https://doi.org/10.1007/978-1-4842-4501-9_5Fig#6"><span class="RefSource">5-6</span></a></span>&nbsp;in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_5_Chapter.xhtml" class="totri-footnote"><span class="RefSource">5</span></a></span>.</p><div class="Para" id="Par84">The command and event flow in the architecture is also similar to the previous example; however, there are subtle differences. Let’s relook at the end-to-end flow, which is labelled in the <span id="ITerm52">diagram</span> as follows:<div class="OrderedList"><ol><li class="ListItem"><span class="ItemNumber">1.</span><div class="ItemContent"><p class="Para" id="Par85">When you click the “Order One Now!” button in the browser, a REST/JSON request hits the order controller.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">2.</span><div class="ItemContent"><p class="Para" id="Par86">The order controller in the Create Command Rest Controller microservice interprets the request as a write request and creates a new order command and sends it to the command gateway, which in turn dispatches the command to the distributed command bus.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">3.</span><div class="ItemContent"><p class="Para" id="Par87">The distributed command bus forms a bridge between the command bus implementations across JVMs. The distributed command bus on each JVM is called a segment.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">4.</span><div class="ItemContent"><p class="Para" id="Par88">The command bus receives commands and routes them to the order command handler, both of them being present in the Handle Command and Create Event microservices.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">5.</span><div class="ItemContent"><p class="Para" id="Par89">The order command handler retrieves the corresponding product and depreciates the stock.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">6.</span><div class="ItemContent"><p class="Para" id="Par90">Upon depreciating the stock of the product, the change is effected in the product repository by sending an update to the product entity, which will get persisted in the Write DB.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">7.</span><div class="ItemContent"><p class="Para" id="Par91">This repository change fires a stock updated event to the event bus, which in turn dispatches events to all interested event listeners.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">8.</span><div class="ItemContent"><p class="Para" id="Par92">The product event handler in the Event Handle Core microservice has subscribed to the stock updated event, so it gets notified with the details of the stock update.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">9.</span><div class="ItemContent"><p class="Para" id="Par93">Based on the details mentioned in the stock updated event, the product event handler makes changes to the read model of the product.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">10.</span><div class="ItemContent"><p class="Para" id="Par94">In step 5, the order command handler depreciated the product stock. Along with that, it also created a new order, based on the details mentioned in the new order command it received.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">11.</span><div class="ItemContent"><p class="Para" id="Par95">When a new order is created, it is effected in the order repository by sending an insert of a new order entity, which subsequently gets persisted in the Write DB.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">12.</span><div class="ItemContent"><p class="Para" id="Par96">This <span id="ITerm53">repository</span> insert fires an order created event to the event bus, which in turn dispatches events to all interested event listeners. There are two interested event listeners, both of them in foreign (different process or nodes) microservices, the Event Handle Core microservice and the Event Handler Audit microservice.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">13.</span><div class="ItemContent"><p class="Para" id="Par97">The order event handler in the Event Handle Core microservice has subscribed to the order created event, so it gets notified with the details of the new order created.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">14.</span><div class="ItemContent"><p class="Para" id="Par98">Based on the details mentioned in the order created event, the order event handler makes changes to the read model of the order, inserting a new row in this case.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">15.</span><div class="ItemContent"><p class="Para" id="Par99">The audit event handler in the Event Handler Audit microservice has also subscribed to the order created event, so it gets notified with the details of the new order created.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">16.</span><div class="ItemContent"><p class="Para" id="Par100">Based on the details mentioned in the order created event, the audit event handler makes changes to the read model of the audit.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">17.</span><div class="ItemContent"><p class="Para" id="Par101">The <span id="ITerm54">browser</span> can refresh itself to keep the view updated from querying the read model of the entities.</p></div><div class="ClearBoth">&nbsp;</div></li><li class="ListItem"><span class="ItemNumber">18.</span><div class="ItemContent"><p class="Para" id="Par102">The user can view changes using the browser.</p></div><div class="ClearBoth">&nbsp;</div></li></ol></div></div></section><section class="Section2 RenderAsSection2" id="Sec11"><h3 class="Heading">Code the Example Scenario</h3><p class="Para" id="Par103">The complete code required to demonstrate the simple Axon example is in folder <span class="EmphasisFontCategoryNonProportional ">ch12\ch12-02</span>. There are five microservices to be coded, and you will look into them one by one.</p><section class="Section3 RenderAsSection3" id="Sec12"><h4 class="Heading">Microservice 1: 01-Ecom-web</h4><p class="Para" id="Par104">This <span id="ITerm55">microservice</span> is a typical Spring Boot web application without any Axon components, so I will not discuss it.</p></section><section class="Section3 RenderAsSection3" id="Sec13"><h4 class="Heading">Microservice 2: 02-Ecom-CreateCommandRestController</h4><div class="Para" id="Par105">Visit <span class="EmphasisFontCategoryNonProportional ">pom.xml</span> to see the axon-distributed-commandbus <span id="ITerm56">dependency</span>; see Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC20">12-13</a></span>.<div class="ProgramCode" id="PC20"><div class="LineGroup"><div class="FixedLine">&lt;dependency&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&lt;groupId&gt;org.axonframework&lt;/groupId&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&lt;artifactId&gt;axon-distributed-commandbus&lt;/artifactId&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&lt;version&gt;2.4.1&lt;/version&gt;</div><div class="FixedLine">&lt;/dependency&gt;</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-13</span><p class="SimplePara">Axon Distributed Command Bus Maven Dependency (ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController\pom.xml)</p></div></div></div></div><div class="Para" id="Par106">A major part of the <span id="ITerm57">code</span> for this example is similar to the previous example, so I will not repeat it here; instead, I will explain all new code as well as any changes to the code from the previous example. The most important class of this example is where you do the setup of all the distributed Axon components, shown in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC21">12-14</a></span>.<div class="ProgramCode" id="PC21"><div class="LineGroup"><div class="FixedLine">@Configuration</div><div class="FixedLine">public class EcomAppConfiguration {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public XStreamSerializer xstreamSerializer() {</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new XStreamSerializer();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("distributedCommandGateway")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public CommandGatewayFactoryBean&lt;CommandGateway&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commandGatewayFactoryBean() {</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CommandGatewayFactoryBean&lt;CommandGateway&gt; factory =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CommandGatewayFactoryBean&lt;&gt;();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.setCommandBus(distributedCommandBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return factory;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public JGroupsConnector getJGroupConnector() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JGroupsConnector connector = new JGroupsConnector(</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new JChannel("udp_config.xml"), "myCluster",</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localSegment(), xstreamSerializer());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connector.connect(100);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return connector;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return null;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("distributedCommandBus")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public DistributedCommandBus distributedCommandBus() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DistributedCommandBus distributedCommandBus =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new DistributedCommandBus(getJGroupConnector());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return distributedCommandBus;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("localCommandBus")<span id="ITerm58">
                        
                        
                        
                        
                      </span></div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public SimpleCommandBus localSegment() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleCommandBus simpleCommandBus = new SimpleCommandBus();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpleCommandBus.setDispatchInterceptors(Arrays.asList(</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new BeanValidationInterceptor()));</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return simpleCommandBus;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-14</span><p class="SimplePara">Distributed Command Bus Configuration (ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController\src\main\java\com\acme\ecom\EcomAppConfiguration.java)</p></div></div></div></div><div class="Para" id="Par107">The DistributedCommandBus forms a bridge between command bus implementations across JVMs. In your case, you want to bridge between the 02-Ecom-CreateCommandRestController microservice and the 03-Ecom-HandleCommandAndCreateEvent microservice, since the former microservice generates commands that are to be handled by the later microservice. So the DistributedCommandBus instances on each JVM are called segments and are qualified with the name localCommandBus in code, as shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig5">12-5</a></span>.<figure class="Figure" id="Fig5"><div class="MediaObject" id="MO5"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig5_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1(4).jpg" style="height:19.75em" width="1725" height="790" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig5_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-5.</span><p class="SimplePara">Distributed command and event handling in Axon</p></div></figcaption></figure></div><p class="Para" id="Par108">The <span id="ITerm59">DistributedCommandBus</span> relies on the CommandBusConnector, which implements the communication protocol between the JVMs. In your case, you use a JGroupsConnector, which uses JGroups to discover and connect to other JGroupsConnectors in the network. Depending on the configuration of the channel that was provided, this implementation allows for dynamic discovery and addition of new members. When members disconnect, their portion of the processing is divided over the remaining members. This dynamic addition and retraction of nodes or JVM or microservices is very important for the required extensibility of your software, which was discussed in the first section in this chapter.</p><p class="Para" id="Par109">There are no changes other than this configuration as far as the code for the Ecom-CreateCommandRestController microservice is concerned, but you may visit the corresponding section in the previous example for an explanation of the rest of the code in this microservice.</p></section><section class="Section3 RenderAsSection3" id="Sec14"><h4 class="Heading">Microservice 3: 03-Ecom-HandleCommandAndCreateEvent</h4><p class="Para" id="Par110">This microservice has to handle any commands created by the 02-Ecom-CreateCommandRestController <span id="ITerm60">microservice</span> and reaching through the DistributedCommandBus from the remote JVM. Further, this microservice also creates events that are supposed to be consumed by distributed event handlers in remote JVMs or foreign microservices. Hence the configuration of this microservice is going to be little complex in order to accommodate all those connectors and routings.</p><div class="Para" id="Par111">Visit <span class="EmphasisFontCategoryNonProportional ">EcomAppConfiguration.java</span> to see the main configuration, shown in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC22">12-15</a></span>.<div class="ProgramCode" id="PC22"><div class="LineGroup"><div class="FixedLine">@Configuration</div><div class="FixedLine">public class EcomAppConfiguration {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@PersistenceContext</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private EntityManager entityManager;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("transactionManager")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;protected PlatformTransactionManager txManager;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("distributedCommandGateway")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public CommandGatewayFactoryBean&lt;CommandGateway&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;commandGatewayFactoryBean() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CommandGatewayFactoryBean&lt;CommandGateway&gt; factory =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CommandGatewayFactoryBean&lt;&gt;();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.setCommandBus(distributedCommandBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return factory;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("localCommandGateway")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public CommandGatewayFactoryBean&lt;CommandGateway&gt;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localCommandGatewayFactoryBean() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CommandGatewayFactoryBean&lt;CommandGateway&gt; factory =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CommandGatewayFactoryBean&lt;&gt;();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;factory.setCommandBus(localSegment());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return factory;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public JGroupsConnector getJGroupConnector() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JGroupsConnector connector = new JGroupsConnector(</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new JChannel("udp_config.xml"), "myCluster",</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;localSegment(), xstreamSerializer());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connector.connect(100);<span id="ITerm61">
                        
                        
                        
                        
                      </span></div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return connector;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("distributedCommandBus")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public DistributedCommandBus distributedCommandBus() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DistributedCommandBus distributedCommandBus =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new DistributedCommandBus(getJGroupConnector());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return distributedCommandBus;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("localCommandBus")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public SimpleCommandBus localSegment() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleCommandBus simpleCommandBus = new SimpleCommandBus();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SpringTransactionManager transcationMgr =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new SpringTransactionManager(txManager);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpleCommandBus.setTransactionManager(transcationMgr);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;simpleCommandBus.setDispatchInterceptors(Arrays.asList</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new BeanValidationInterceptor()));</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return simpleCommandBus;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public AnnotationCommandHandlerBeanPostProcessor</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotationCommandHandlerBeanPostProcessor() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnnotationCommandHandlerBeanPostProcessor processor =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new AnnotationCommandHandlerBeanPostProcessor();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processor.setCommandBus(distributedCommandBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return processor;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-15</span><p class="SimplePara">Distributed Command Bus Configuration (Visit ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent\src\main\java\com\acme\ecom\EcomAppConfiguration.java)</p></div></div></div></div><div class="Para" id="Par112">You already saw the <span id="ITerm62">explanation</span> for the distributed command bus configuration of Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC21">12-14</a></span>, so I will now explain the distributed command processing infrastructure in Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC22">12-15</a></span>. Let’s move on to the event infrastructure; see Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC23">12-16</a></span>.<div class="ProgramCode" id="PC23"><div class="LineGroup"><div class="FixedLine">@Configuration</div><div class="FixedLine">public class EcomAppConfiguration {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@PersistenceContext</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;private EntityManager entityManager;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Qualifier("transactionManager")</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;protected PlatformTransactionManager txManager;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public ConnectionFactory connectionFactory() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CachingConnectionFactory connectionFactory =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new CachingConnectionFactory();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory.setAddresses(rabbitMQAddress);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory.setUsername(rabbitMQUser);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory.setPassword(rabbitMQPassword);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory.setVirtualHost(rabbitMQVhost);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory.setConnectionTimeout(500000);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory.setRequestedHeartBeat(20);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return connectionFactory;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public FanoutExchange eventBusExchange() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new FanoutExchange(rabbitMQExchange, true, false);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public Queue eventBusQueue() {<span id="ITerm63">
                        
                        
                        
                        
                      </span></div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new Queue(rabbitMQQueue, true, false, false);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public Binding binding() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return BindingBuilder.bind(eventBusQueue()).to(eventBusExchange());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public EventBus eventBus() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClusteringEventBus clusteringEventBus = new ClusteringEventBus(</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new DefaultClusterSelector(simpleCluster()), terminal());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return clusteringEventBus;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public DefaultAMQPMessageConverter defaultAMQPMessageConverter() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return new DefaultAMQPMessageConverter(xstreamSerializer());<span id="ITerm64">
                        
                        
                        
                        
                      </span></div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;ListenerContainerLifecycleManager listenerContainerLifecycleManager() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ListenerContainerLifecycleManager listenerContainerLifecycleManager =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new ListenerContainerLifecycleManager();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listenerContainerLifecycleManager.setConnectionFactory(</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connectionFactory());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return listenerContainerLifecycleManager;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public AnnotationEventListenerBeanPostProcessor</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;annotationEventListenerBeanPostProcessor() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AnnotationEventListenerBeanPostProcessor processor =</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new AnnotationEventListenerBeanPostProcessor();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processor.setEventBus(eventBus());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return processor;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Bean</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public EventBusTerminal terminal() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SpringAMQPTerminal terminal = new SpringAMQPTerminal();</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal.setConnectionFactory(connectionFactory());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal.setSerializer(xstreamSerializer());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal.setExchangeName(rabbitMQExchange);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal.setListenerContainerLifecycleManager(</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;listenerContainerLifecycleManager());</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal.setDurable(true);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminal.setTransactional(true);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return terminal;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;SimpleCluster simpleCluster() {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SimpleCluster simpleCluster = new SimpleCluster(rabbitMQQueue);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return simpleCluster;</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-16</span><p class="SimplePara">Clustered Event Bus Configuration</p></div></div></div></div><div class="Para" id="Par113">The <span id="ITerm65">ClusteringEventBus</span> dispatches<span id="ITerm66">
                  
                  
                  
                  
                </span> events to event handlers across different machines. A ClusteringEventBus has to be configured with a ClusterSelector, which selects a Cluster instance for each of the registered EventListeners, and an <span id="ITerm67">EventBusTerminal</span>, which is responsible for dispatching events to each of the relevant clusters. In the code above, you use <span id="ITerm68">DefaultClusterSelector </span>as the ClusterSelector, which always selects the same cluster. This implementation can serve as a delegate for other cluster selectors for event listeners that do not belong to a specific cluster. The DefaultClusterSelector in turn uses a simple Cluster implementation that invokes each of the members of a cluster when an event is published. The next important component is the EventBusTerminal, which is a mechanism that connects event bus clusters. The terminal is responsible for delivering published events with all of the clusters available in the event bus (either locally or remotely). Terminals are typically bound to a single event bus instance, but may be aware that multiple instances exist in order to form a bridge between these event buses. You use a <span id="ITerm69">SpringAMQPTerminal</span>, which is an implementation of EventBusTerminal that uses an AMQP 0.9-compatible message broker to dispatch event messages. This is because you are using <span id="ITerm70">Rabbit MQ</span>, which is AMQP-compatible, as the message queue provider that provides the backbone for the distributed event channel. All outgoing messages are sent to a configured exchange. This terminal does not dispatch events internally, as it relies on each cluster to listen to its own AMQP queue. Again, as shown in the code, the terminal is configured with the ConnectionFactory providing the connections and channels to send messages. Although they are a little too complex to understand, the good thing is that Axon abstracts much of these complexities and you can visualize the whole set up as shown in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig6">12-6</a></span>.<figure class="Figure" id="Fig6"><div class="MediaObject" id="MO6"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig6_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1(5).jpg" style="height:40.72em" width="1474" height="1629" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig6_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-6.</span><p class="SimplePara">Distributed event processing in a <span id="ITerm71">clustered event bus</span></p></div></figcaption></figure></div><p class="Para" id="Par114">If you understand the previous example, there is absolutely nothing new in this microservice.</p></section><section class="Section3 RenderAsSection3" id="Sec15"><h4 class="Heading">Microservice 4: 04-Ecom-EventHandleCore</h4><p class="Para" id="Par115">Again, if you have followed the <span id="ITerm72">previous</span> example, there is nothing new in this microservice, so I will not do a code walkthrough. As the name of the microservice hints, it contains the two main event handlers, OrderEventHandler and ProductEventHandler, and the functionality and code snippets are similar to those in the previous example.</p></section><section class="Section3 RenderAsSection3" id="Sec16"><h4 class="Heading">Microservice 5: 05-Ecom-EventHandlerAudit</h4><p class="Para" id="Par116">This is a new microservice. The intention is to demonstrate the extensibility of the Axon-based CQRS architecture where, in the future if you <span id="ITerm73">have</span> a new functionality that wants to subscribe to existing events and add to the existing overall functionality of the application, you should be able to do that without any downtime of the existing running application.</p><div class="Para" id="Par117">Listing <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#PC24">12-17</a></span> shows the code for the newly added event handler, which is expecting to be notified of the previously handled event itself.<div class="ProgramCode" id="PC24"><div class="LineGroup"><div class="FixedLine">@Component</div><div class="FixedLine">public class AuditEventHandler {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@Autowired</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;DataSource dataSource;</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;@EventHandler</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;public void handleOrderCreatedEvent(OrderCreatedEvent event) {</div></div><div class="LineGroup"><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;JdbcTemplate jdbcTemplate = new JdbcTemplate(dataSource);</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jdbcTemplate.update("INSERT INTO ecom_order_audit VALUES(?,?,?)",</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new Object[]{event.getId(),</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;event.getOrderStatus(), new Date()});</div><div class="FixedLine">&nbsp;&nbsp;&nbsp;&nbsp;}</div><div class="FixedLine">}</div></div><div class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Listing 12-17</span><p class="SimplePara">Event Handler for the newly introduced Microservice (ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit\src\main\java\com\acme\ecom\order\eventhandler\AuditEventHandler.java)</p></div></div></div></div></section></section><section class="Section2 RenderAsSection2" id="Sec17"><h3 class="Heading">Build and Test the Example Scenario</h3><div class="Para" id="Par118">As the first step<span id="ITerm74">
                
                
                
              </span>, you need to bring up the RabbitMQ server. You may want to refer to Appendix B to get started with RabbitMQ server.<div class="ProgramCode" id="PC25"><div class="LineGroup"><div class="FixedLine">D:\Applns\RabbitMQ\rabbitmq_server-3.6.3\sbin&gt;D:\Applns\RabbitMQ\rabbitmq_server-3.6.3\sbin\rabbitmq-server.bat</div></div></div></div><p class="Para" id="Par119">Make sure MySQL is up and running. You may want to refer to Appendix H to get started with MySQL.</p><div class="Para" id="Par120">To start with clean tables, delete any tables with the names you want for this example:<div class="ProgramCode" id="PC26"><div class="LineGroup"><div class="FixedLine">mysql&gt; drop table ecom_order;</div><div class="FixedLine">mysql&gt; drop table ecom_product;</div><div class="FixedLine">mysql&gt; drop table ecom_order_view;</div><div class="FixedLine">mysql&gt; drop table ecom_product_view;</div><div class="FixedLine">mysql&gt; drop table ecom_order_audit;</div></div></div></div><div class="Para" id="Par121">Newly create the required tables. Now the <span class="EmphasisFontCategoryNonProportional ">ecom_order</span> table and the <span class="EmphasisFontCategoryNonProportional ">ecom_product</span> table will be created when the microservice starts up. However, you need to explicitly create the Read DB tables and the table for Audit:<div class="ProgramCode" id="PC27"><div class="LineGroup"><div class="FixedLine">mysql&gt;create table ecom_product_view(id INT , price DOUBLE, stock INT ,description VARCHAR(255));</div><div class="FixedLine">mysql&gt;create table ecom_order_view(id INT , price DOUBLE, number INT ,description VARCHAR(225),status VARCHAR(50));</div><div class="FixedLine">mysql&gt;create table ecom_order_audit(id INT ,status VARCHAR(50),date TIMESTAMP);</div></div></div></div><div class="Para" id="Par122">The example has a Maven module that contains the common classes used by all other microservices. Hence this has to be built first:<div class="ProgramCode" id="PC28"><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\06-Ecom-common</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\06-Ecom-common&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\06-Ecom-common&gt;mvn clean install</div></div></div></div><p class="Para" id="Par123">Next, there are five microservices to build and get running. You will do one at a time.</p><section class="Section3 RenderAsSection3" id="Sec18"><h4 class="Heading">Microservice 1: 01-Ecom-web</h4><div class="Para" id="Par124">First, update the configuration files to suit to your environment:<div class="ProgramCode" id="PC29"><div class="LineGroup"><div class="FixedLine">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web\src\main\resources\application.properties</div><div class="FixedLine">server.port=8080</div></div></div></div><p class="Para" id="Par125">I advise you not to make any changes here.</p><div class="Para" id="Par126">Now, build and package the executables for the Ecom-web microservice and bring up the server. There is a utility script at <span class="EmphasisFontCategoryNonProportional ">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web\make.bat</span>:<div class="ProgramCode" id="PC30"><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web&gt;mvn clean install</div></div></div></div><div class="Para" id="Par127">You can run the Spring Boot application in more than one way. The straightforward way is to execute the JAR file via the following commands:<div class="ProgramCode" id="PC31"><div class="LineGroup"><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web&gt;run</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\01-Ecom-web&gt;java -jar .\target\01-Ecom-web-0.0.1-SNAPSHOT.jar</div></div></div></div><p class="Para" id="Par128">This will bring up the 01-Ecom-web Spring Boot Server in port 8080.</p></section><section class="Section3 RenderAsSection3" id="Sec19"><h4 class="Heading">Microservice 2: 02-Ecom-CreateCommandRestController</h4><p class="Para" id="Par129">The JGroups configuration is provided at <span class="EmphasisFontCategoryNonProportional ">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController\src\main\resources\udp_config.xml</span>.</p><p class="Para" id="Par130">However, don’t worry about the contents of this file too much for now.</p><div class="Para" id="Par131">Update the configuration files to suit to your environment:<div class="ProgramCode" id="PC32"><div class="LineGroup"><div class="FixedLine">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController\src\main\resources\application.properties</div><div class="FixedLine">server.port=8081</div><div class="FixedLine">spring.datasource.url=jdbc:mysql://localhost/ecom01</div><div class="FixedLine">spring.datasource.username=root</div><div class="FixedLine">spring.datasource.password=rootpassword</div></div></div></div><div class="Para" id="Par132">Now, build the microservice:<div class="ProgramCode" id="PC33"><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController&gt;mvn clean install</div></div></div></div><div class="Para" id="Par133">You can run the 02-Ecom-CreateCommandRestController Axon Spring Boot application in more than one way. The straightforward way is to execute the JAR file via the following commands:<div class="ProgramCode" id="PC34"><div class="LineGroup"><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController&gt;run</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\02-Ecom-CreateCommandRestController&gt;java -jar .\target\02-Ecom-CreateCommandRestController-0.0.1-SNAPSHOT.jar</div></div></div></div><p class="Para" id="Par134">This will bring up the 02-Ecom-CreateCommandRestController Axon Spring Boot Server in port 8081.</p></section><section class="Section3 RenderAsSection3" id="Sec20"><h4 class="Heading">Microservice 3: 03-Ecom-HandleCommandAndCreateEvent</h4><div class="Para" id="Par135">Update the configuration files to suit to your environment:<div class="ProgramCode" id="PC35"><div class="LineGroup"><div class="FixedLine">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent\src\main\resources\application.properties</div><div class="FixedLine">server.port=8082</div><div class="FixedLine">spring.datasource.url=jdbc:mysql://localhost/ecom01</div><div class="FixedLine">spring.datasource.username=root</div><div class="FixedLine">spring.datasource.password=rootpassword</div></div><div class="LineGroup"><div class="FixedLine">ecom.amqp.rabbit.address= 127.0.0.1:5672</div><div class="FixedLine">ecom.amqp.rabbit.username= guest</div><div class="FixedLine">ecom.amqp.rabbit.password= guest</div><div class="FixedLine">ecom.amqp.rabbit.vhost=/</div><div class="FixedLine">ecom.amqp.rabbit.exchange=Ecom-02</div><div class="FixedLine">ecom.amqp.rabbit.queue=Ecom-createcommand</div></div><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent&gt;mvn clean install</div></div></div></div><div class="Para" id="Par136">You can run the 03-Ecom-HandleCommandAndCreateEvent Axon Spring Boot application in more than one way. The straightforward way is to execute the JAR file via the following commands:<div class="ProgramCode" id="PC36"><div class="LineGroup"><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent&gt;run</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\03-Ecom-HandleCommandAndCreateEvent&gt;java -jar .\target\03-Ecom-HandleCommandAndCreateEvent-0.0.1-SNAPSHOT.jar</div></div></div></div><p class="Para" id="Par137">This will bring up the 02-Ecom-CreateCommandRestController Axon Spring Boot Server in port 8082.</p></section><section class="Section3 RenderAsSection3" id="Sec21"><h4 class="Heading">Microservice 4: 04-Ecom-EventHandleCore</h4><div class="Para" id="Par138">Update the configuration files to suit to your environment:<div class="ProgramCode" id="PC37"><div class="LineGroup"><div class="FixedLine">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\04-Ecom-EventHandleCore\src\main\resources\application.properties</div><div class="FixedLine">server.port=8083</div><div class="FixedLine">spring.datasource.url=jdbc:mysql://localhost/ecom01</div><div class="FixedLine">spring.datasource.username=root</div><div class="FixedLine">spring.datasource.password=rootpassword</div></div><div class="LineGroup"><div class="FixedLine">ecom.amqp.rabbit.address= 127.0.0.1:5672</div><div class="FixedLine">ecom.amqp.rabbit.username= guest</div><div class="FixedLine">ecom.amqp.rabbit.password= guest</div><div class="FixedLine">ecom.amqp.rabbit.vhost=/</div><div class="FixedLine">ecom.amqp.rabbit.exchange=Ecom-02</div><div class="FixedLine">ecom.amqp.rabbit.queue=Ecom-event-core</div></div><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\04-Ecom-EventHandleCore</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\04-Ecom-EventHandleCore&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\04-Ecom-EventHandleCore&gt;mvn clean install</div></div></div></div><div class="Para" id="Par139">You can run the 04-Ecom-EventHandleCore Axon Spring Boot application in more than one way. The straightforward way is to execute the JAR file via the following commands:<div class="ProgramCode" id="PC38"><div class="LineGroup"><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\04-Ecom-EventHandleCore&gt;run</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\04-Ecom-EventHandleCore&gt;java -jar .\target\04-Ecom-EventHandleCore-0.0.1-SNAPSHOT.jar</div></div></div></div><p class="Para" id="Par140">This will bring up the 04-Ecom-EventHandleCore Axon Spring Boot Server in port 8083.</p></section><section class="Section3 RenderAsSection3" id="Sec22"><h4 class="Heading">Microservice 5: 05-Ecom-EventHandlerAudit</h4><div class="Para" id="Par141">This is the last microservice you want to bring up in this example. Update the configuration files to suit to your environment:<div class="ProgramCode" id="PC39"><div class="LineGroup"><div class="FixedLine">ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit\src\main\resources\application.properties</div><div class="FixedLine">server.port=8084</div><div class="FixedLine">spring.datasource.url=jdbc:mysql://localhost/ecom01</div><div class="FixedLine">spring.datasource.username=root</div><div class="FixedLine">spring.datasource.password=rootpassword</div></div><div class="LineGroup"><div class="FixedLine">ecom.amqp.rabbit.address= 127.0.0.1:5672</div><div class="FixedLine">ecom.amqp.rabbit.username= guest</div><div class="FixedLine">ecom.amqp.rabbit.password= guest</div><div class="FixedLine">ecom.amqp.rabbit.vhost=/</div><div class="FixedLine">ecom.amqp.rabbit.exchange=Ecom-02</div><div class="FixedLine">ecom.amqp.rabbit.queue=Ecom-event-history</div></div><div class="LineGroup"><div class="FixedLine">cd D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit&gt;make</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit&gt;mvn clean install</div></div></div></div><div class="Para" id="Par142">You can run the 05-Ecom-EventHandlerAudit Axon Spring Boot application again in more than one way. The straightforward way is to execute the JAR file via the following commands:<div class="ProgramCode" id="PC40"><div class="LineGroup"><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit&gt;run</div><div class="FixedLine">D:\binil\gold\pack03\ch12\ch12-02\Ax2-Commands-Multi-Event-Handler-Distributed\05-Ecom-EventHandlerAudit&gt;java -Dserver.port=8084 -Dspring.application.name=product-audit-01 -jar .\target\05-Ecom-EventHandlerAudit-0.0.1-SNAPSHOT.jar</div></div></div></div><p class="Para" id="Par143">This will bring up the 05-Ecom-EventHandlerAudit Axon Spring Boot Server in port 8084.</p><div class="Para" id="Par144">You want to prepopulate the <span class="EmphasisFontCategoryNonProportional ">ecom_product</span> and <span class="EmphasisFontCategoryNonProportional ">ecom_product_view</span> tables with some initial data:<div class="ProgramCode" id="PC41"><div class="LineGroup"><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(1,'Shirts',100,5,0);</div><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(2,'Pants',100,5,0);</div><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(3,'T-Shirt',100,5,0);</div><div class="FixedLine">mysql&gt; insert into ecom_product(id,description,price,stock,version) values(4,'Shoes',100,5,0);</div></div><div class="LineGroup"><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(1,'Shirts',100,5);</div><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(2,'Pants',100,5);</div><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(3,'T-Shirt',100,5);</div><div class="FixedLine">mysql&gt; insert into ecom_product_view(id,description,price,stock) values(4,'Shoes',100,5);</div></div></div></div><p class="Para" id="Par145">You can use a browser (preferably Chrome) and point to <span class="EmphasisFontCategoryNonProportional ">http://localhost:8080/</span>.</p><div class="Para" id="Par146">You can now test the example by clicking any one of the buttons in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig7">12-7</a></span>. When you click, a new order is created in the Order Write DB. Eventually, the Order Read DB will be updated with this new order. Also, the corresponding product stock will be reduced by one in the Product Write DB. This change will also be eventually updated in the Product Read DB.<figure class="Figure" id="Fig7"><div class="MediaObject" id="MO7"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig7_HTML.jpg" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1(6).jpg" style="height:21.9em" width="1725" height="876" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig7_HTML.jpg"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-7.</span><p class="SimplePara">Testing the distributed command and event processing example</p></div></figcaption></figure></div><div class="Para" id="Par147">There is another aspect to be noted here. The new microservice you added in this example is responsible for the audit log entries, so the Audit Read DB is updated with records. When you refresh the screen, the change is as reflected in Figure <span class="InternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fig8">12-8</a></span>. (If the change is not reflected, you may close the browser session and make a new browser instance and try the above URL. Again, there may be little gotchas in the GUIs provided with the examples in the book since this book’s concentration is on microservices, not on the perfectness of their UIs.)<figure class="Figure" id="Fig8"><div class="MediaObject" id="MO8"><img alt="../images/477630_1_En_12_Chapter/477630_1_En_12_Fig8_HTML.png" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/477630_1_En_12.png" style="height:19.72em" width="1721" height="789" data-mfp-src="/library/view/practical-microservices-architectural/9781484245019/images/477630_1_En_12_Chapter/477630_1_En_12_Fig8_HTML.png"></div><figcaption class="Caption" lang="en"><div class="CaptionContent"><span class="CaptionNumber">Figure 12-8.</span><p class="SimplePara">Product view synced with product write data</p></div></figcaption></figure></div><p class="Para" id="Par148">What is different from the example in the previous section is that in the current example, the same event OrderCreatedEvent is consumed by two event handlers. This demonstrates the extensibility of the architecture. To make it clear, you may create a sixth microservice with a new event handler for the same event, and if you can bring it up without disturbing the already existing five microservices, then from next command onwards the event will be consumed by the newly attached sixth microservice too!</p></section></section></section><section class="Section1 RenderAsSection1" id="Sec23"><h2 class="Heading">Summary</h2><p class="Para" id="Par149">You have reached a major milestone in this book by executing the examples in this chapter, since they are live code in action and they explain many of the concepts discussed in this book so far. You saw what a CQRS application will look like in the familiar Spring Boot framework, and you also saw how to distribute one into multiple microservices, also communicating with other using events over a messaging middleware. So far, so good; however, you have now invited “Satan”<sup><a epub:type="noteref" href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fn3" id="Fn3_source" class="totri-footnote">3</a></sup> into your architecture: the partition. By bringing the capability to partition your single JVM CQRS application in the first example into multiple microservices in the second example, you now need to address the consistency aspects you explored via the CAP theorem in Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_11_Chapter.xhtml"><span class="RefSource">11</span></a></span>. To discuss that in detail further, you should first know the foundations of consistency in the context of microservices, so move on to Chapter <span class="ExternalRef"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_13_Chapter.xhtml"><span class="RefSource">13</span></a></span>.</p></section><aside class="FootnoteSection" epub:type="footnotes"><div class="Heading">Footnotes</div><div class="Footnote"><span class="FootnoteNumber"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fn1_source" class="totri-footnote">1</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn1"><p class="Para" id="Par13">Axon framework 2.4 Reference guide: <span class="ExternalRef"><a href="http://www.axonframework.org/docs/2.4/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">www.axonframework.org/docs/2.4/</span>
                  </span></a></span></p></div><div class="ClearBoth">&nbsp;</div></div><div class="Footnote"><span class="FootnoteNumber"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fn2_source" class="totri-footnote">2</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn2"><p class="Para" id="Par14">Axon framework 2.4 API Documentation: <span class="ExternalRef"><a href="https://axoniq.io/apidocs/2.4/"><span class="RefSource">
                    <span class="EmphasisFontCategoryNonProportional ">https://axoniq.io/apidocs/2.4/</span>
                  </span></a></span></p></div><div class="ClearBoth">&nbsp;</div></div><div class="Footnote"><span class="FootnoteNumber"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#Fn3_source" class="totri-footnote">3</a></span><div class="FootnoteContent" epub:type="footnote" id="Fn3"><p class="Para" id="Par150">Satan is the name used by Christians and Jews for the Devil (= a powerful evil force and the enemy of God).</p></div><div class="ClearBoth">&nbsp;</div></div></aside></div><div class="annotator-outer annotator-viewer viewer annotator-hide">
  <ul class="annotator-widget annotator-listing"></ul>
</div><div class="annotator-modal-wrapper annotator-editor-modal annotator-editor annotator-hide">
	<div class="annotator-outer editor">
		<h2 class="title">Highlight</h2>
		<form class="annotator-widget">
			<ul class="annotator-listing">
			<li class="annotator-item"><textarea id="annotator-field-0" placeholder="Add a note using markdown (optional)" class="js-editor" maxlength="750"></textarea></li></ul>
			<div class="annotator-controls">
				<a class="link-to-markdown" href="https://daringfireball.net/projects/markdown/basics" target="_blank">?</a>
				<ul>
					<li class="delete annotator-hide"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#delete" class="annotator-delete-note button positive">Delete Note</a></li>
					<li class="save"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#save" class="annotator-save annotator-focus button positive">Save Note</a></li>
					<li class="cancel"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#cancel" class="annotator-cancel button">Cancel</a></li>
				</ul>
			</div>
		</form>
	</div>
</div><div class="annotator-modal-wrapper annotator-delete-confirm-modal" style="display: none;">
  <div class="annotator-outer">
    <h2 class="title">Highlight</h2>
      <a class="js-close-delete-confirm annotator-cancel close" href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#close">Close</a>
      <div class="annotator-widget">
         <div class="delete-confirm">
            Are you sure you want to permanently delete this note?
         </div>
         <div class="annotator-controls">
            <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#cancel" class="annotator-cancel button js-cancel-delete-confirm">No, I changed my mind</a>
            <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#delete" class="annotator-delete button positive js-delete-confirm">Yes, delete it</a>
         </div>
       </div>
   </div>
</div><div class="annotator-adder" style="display: none; top: 37289.8px; left: 300.5px; width: 259px;">
	<ul class="adders expandUp">
		
		<li class="copy"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#">Copy</a></li>
		
		<li class="add-highlight"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#">Add Highlight</a></li>
		<li class="add-note"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#">
			Add Note
		</a></li>
		
	</ul>
</div></div></div>



  <div class="t-sbo-prev sbo-prev sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_11_Chapter.xhtml" class="prev nav-link">
      
          <span aria-hidden="true" class="pagination-label t-prev-label">Prev</span>
          <span class="visuallyhidden">Previous Chapter</span>
          <div class="pagination-title t-prev-title">11.&nbsp;Events, Eventuality, and Consistency</div>
        </a>
    
  
  </div>

  <div class="t-sbo-next sbo-next sbo-nav-bottom">
  
    
      
        <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_13_Chapter.xhtml" class="next nav-link">
      
          <span aria-hidden="true" class="pagination-label t-next-label">Next</span>
          <span class="visuallyhidden">Next Chapter</span>
          <div class="pagination-title t-next-title">13.&nbsp;Distributed Transactions</div>
        </a>
    
  
  </div>


        
    </section>
  </div>
<section class="sbo-saved-archives"></section>



          
          
  




    
    



        
      </div>
      
        

<footer class="pagefoot t-pagefoot">
  <a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" class="icon-up" onclick="window.Appcues.track(&#39;JumpTop_HeronBook&#39;)" style="display: block;"><div class="visuallyhidden">Back to top</div></a>
  <ul class="js-footer-nav">
  
    
    <li><a href="https://learning.oreilly.com/u/preferences/">Settings</a></li>
    
    <li><a href="https://learning.oreilly.com/public/support/">Support</a></li>
    
    <li><a href="https://learning.oreilly.com/accounts/logout/">Sign Out</a></li>
    
  
  
  </ul>
  <span class="copyright">© 2020 <a href="https://learning.oreilly.com/" target="_blank">O'Reilly Media, Inc</a>.</span>
  
    
    <a href="https://www.oreilly.com/terms/">Terms of Service</a> 
     / 
    
    <a href="https://learning.oreilly.com/privacy">Privacy Policy</a> 
    
    
  
</footer>

      
    
    <script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/saved_resource" charset="utf-8"></script>
    <script src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/saved_resour(1)" charset="utf-8"></script>
  

<div></div><div></div><div class="annotator-notice"></div><div class="font-flyout" style="top: 201.012px; left: 1280px;"><div class="font-controls-panel">
	<div class="nightmodes">
		<ul>
			<li class="day"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" id="day-mode" title="Day Mode">
				<i class="fa fa-sun-o"></i>
				<span>Day Mode</span></a></li>
			<li class="cloudy"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" id="cloudy-mode" title="Cloudy Mode">
				<i class="fa fa-cloud"></i>
				<span>Cloud Mode</span>
			</a></li>
			<li class="night"><a href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#" id="night-mode" title="Night Mode">
				<i class="fa fa-moon-o"></i>
				<span>Night Mode</span>
			</a></li>
		</ul>
	</div>

	<div class="font-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-font left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-font-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-font right"></i>
		</div>
	</div>

	<div class="column-resizer resizer">
		<div class="draggable-containment-wrapper">
			<i class="fa fa-compress left"></i>
			<span class="filler" style="width: 50%;"></span>
			<div id="js-column-size-draggable" class="draggable ui-widget-content ui-draggable ui-draggable-handle" style="position: relative; left: 80px;"></div>
			<i class="fa fa-expand right"></i>
		</div>
	</div>

	<a id="reset" class="button" href="https://learning.oreilly.com/library/view/practical-microservices-architectural/9781484245019/html/477630_1_En_12_Chapter.xhtml#">Reset</a>
</div>
</div><iframe src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/pixel.html" style="display: none;"></iframe><script type="text/javascript" async="" src="./12. Axon for CQRS Architecture - Practical Microservices Architectural Patterns_ Event-Based Java Microservices with Spring Boot and Spring Cloud_files/generic15959426.下载" charset="UTF-8"></script><span></span><div style="display: none; visibility: hidden;"><script>(function(){if(null!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')&&void 0!==document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]')){var a=!1;window.addEventListener("blur",function(){a&&dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"facebook",eventVal:0,nonInteraction:0})});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseover",function(){window.focus();
a=!0});document.querySelector('iframe[title\x3d"fb:share_button Facebook Social Plugin"]').addEventListener("mouseout",function(){a=!1})}if(null!==document.querySelector("iframe.twitter-share-button")&&void 0!==document.querySelector("iframe.twitter-share-button")){var b=!1;window.addEventListener("blur",function(){b&&dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"twitter",eventVal:0,nonInteraction:0})});document.querySelector("iframe.twitter-share-button").addEventListener("mouseover",
function(){window.focus();b=!0});document.querySelector("iframe.twitter-share-button").addEventListener("mouseout",function(){b=!1})}try{window.twttr=function(a,b,d){var c,e=a.getElementsByTagName(b)[0];if(!a.getElementById(d))return a=a.createElement(b),a.id=d,a.src="//platform.twitter.com/widgets.js",e.parentNode.insertBefore(a,e),window.twttr||(c={_e:[],ready:function(a){c._e.push(a)}})}(document,"script","twitter-wjs"),twttr.ready(function(a){a.events.bind("tweet",trackTwitter)})}catch(c){}})();
null!==document.querySelector(".IN-widget")&&void 0!==document.querySelector(".IN-widget")&&document.querySelector(".IN-widget").addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"linkedin",eventVal:0,nonInteraction:0})});
function trackTwitter(a){a&&(a.target&&"IFRAME"==a.target.nodeName&&(opt_target=extractParamFromUri(a.target.src,"url")),dataLayer.push({event:"eventTracker",eventCat:"social",eventAct:"share",eventLbl:"twitter",eventVal:0,nonInteraction:0}))}function extractParamFromUri(a,b){if(a&&(b=new RegExp("[\\?\x26#]"+b+"\x3d([^\x26#]*)"),a=b.exec(a),null!=a))return unescape(a[1])};</script></div><script type="text/javascript" id="">function forceInputUppercase(a){var b=a.target.selectionStart,c=a.target.selectionEnd;a.target.value=a.target.value.toUpperCase();a.target.setSelectionRange(b,c)}void 0!=document.getElementById("id_promotion")&&null!=document.getElementById("id_promotion")&&document.getElementById("id_promotion").addEventListener("keyup",forceInputUppercase,!1);
void 0!=document.getElementsByName("promotionCode")[0]&&null!=document.getElementsByName("promotionCode")[0]&&document.getElementsByName("promotionCode")[0].addEventListener("keyup",forceInputUppercase,!1);</script><script type="text/javascript" id="">var nonwExpandable=document.querySelectorAll(".orm-ff-NavigationSubnav-headerListItem a, .orm-ff-NavigationView-headerListItem a");nonwExpandable.forEach(function(a,b){b+1!=nonwExpandable.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):b+1==nonwExpandable.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var nonwExpandableFo=document.querySelectorAll(".drop-content li:not(.flyout-parent) a");
nonwExpandableFo.forEach(function(a,b){"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1!=nonwExpandableFo.length?a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.childNodes[1].textContent})}):"drop-content"==a.parentNode.parentNode.parentNode.className&&b+1==nonwExpandableFo.length&&a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"user login",eventAct:"logout",eventLbl:"global nav | unified"})})});
var expandable=document.querySelectorAll(".orm-ff-NavigationSubnav-toggleControls a, .orm-ff-NavigationView-toggleControls a");expandable.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.parentNode.parentNode.parentNode.querySelectorAll(".orm-Button-btnContentWrap span")[0].childNodes[1].textContent+" | "+a.textContent})})});var flyoutLinks=document.querySelectorAll(".flyout a");
flyoutLinks.forEach(function(a){a.addEventListener("click",function(){dataLayer.push({event:"eventTracker",eventCat:"global nav",eventAct:"navigation",eventLbl:a.closest("li.flyout-parent").getElementsByTagName("a")[0].textContent+" | "+a.textContent})})});</script></body></html>